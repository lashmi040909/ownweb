<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊùéËØóÊ∑ºÁöÑÁßòÂØÜËä±Âõ≠</title>
    <style>
        :root {
            --dark-green: #2E7D32;
            --light-green: #4CAF50;
            --bright-pink: #FF69B4;
            --soft-pink: #FFC0CB;
            --lighter-yellow: #FFF8E1;
            --light-pink: #FFB6C1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        /* Â∞ÅÈù¢È°µÈù¢Ê†∑Âºè */
        .cover-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        .cover-text {
            text-align: center;
            color: #333;
            position: relative;
            z-index: 1002;
        }

        .chinese-text {
            font-size: 48px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .english-text {
            font-size: 24px;
            font-style: italic;
        }

        /* ÂÆö‰πâÊñáÂ≠óÂå∫ÂüüÁöÑÂÆâÂÖ®ËåÉÂõ¥ */
        .safe-zone {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 200px;
            z-index: 1001;
        }

        /* ÂèØÁÇπÂáªÂå∫ÂüüÊ†∑Âºè */
        .click-area {
            position: absolute;
            width: 350px;
            height: 350px;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #333;
            font-weight: bold;
            z-index: 1001;
        }

        .click-area:hover {
            transform: scale(1.1);
        }

        .click-area img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .click-area span {
            display: none;
        }

        .camera-area, .cat-area, .notebook-area, .palette-area {
            position: absolute;
        }

        .camera-area {
            top: 5%;
            left: 5%;
        }

        .camera-area span {
            display: none;
        }

        .cat-area {
            top: 5%;
            right: 5%;
        }

        .notebook-area {
            bottom: 5%;
            left: 5%;
        }

        .palette-area {
            bottom: 5%;
            right: 5%;
        }

        .main-content {
            display: none;
        }

        :root {
            --dark-green: #2E7D32;
            --light-green: #4CAF50;
            --bright-pink: #FF69B4;
            --soft-pink: #FFC0CB;
            --lighter-yellow: #FFF8E1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.9);
        }

        .bg-pattern {
            background: none;
        }

        .navigation {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-list {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .nav-item {
            padding: 0.5rem 1rem;
            color: var(--dark-green);
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--bright-pink);
            color: white;
            transform: translateY(-2px);
        }

        .container {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            backdrop-filter: blur(5px);
            margin: 2rem auto;
            padding: 3rem 4rem;
            max-width: 1200px;
            width: 85%;
        }

        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            position: relative;
            z-index: 1;
        }

        .page.active {
            display: block;
            opacity: 1;
        }

        /* È¶ñÈ°µÊ†∑Âºè */
        .welcome-section {
            text-align: center;
            padding: 6rem 0;
            position: relative;
            margin-left: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
        }

        .welcome-title {
            font-family: 'Arial', cursive;
            color: #4CAF50;
            font-size: 5rem;
            margin-bottom: 2rem;
            line-height: 1.4;
            font-weight: bold;
            text-transform: none;
            animation: none;
            text-align: center;
        }

        .welcome-subtitle {
            color: #2E7D32;
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .category-text {
            display: flex;
            justify-content: center;
            margin-top: 4rem;
            font-size: 2.5rem;
            color: #4CAF50;
            opacity: 0.7;
            width: 100%;
        }

        .category-text span {
            margin: 0 4rem;
            position: relative;
        }

        .category-text span::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #4CAF50;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .category-text span:hover::after {
            transform: scaleX(1);
        }

        .life-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem;
            padding: 2rem 0;
            max-width: 1000px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            aspect-ratio: 1;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .gallery-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 1.5rem;
            color: white;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
            transform: translateY(0);
        }

        .gallery-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .gallery-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .gallery-category {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--bright-pink);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 2rem;
                width: 90%;
            }
            
            .life-gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1.5rem;
                width: 95%;
            }
            
            .life-gallery {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature-card {
            background: var(--lighter-yellow);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* ÂÖ≥‰∫éÈ°µÈù¢Ê†∑Âºè */
        .bg-lighter-yellow {
            background-color: rgba(255, 248, 225, 0.8);
            backdrop-filter: blur(5px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .bg-lighter-yellow:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .text-dark-green {
            color: var(--dark-green);
        }

        .text-bright-pink {
            color: var(--bright-pink);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 2.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .hover-glow {
            transition: all 0.3s ease;
        }

        .hover-glow:hover {
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.3);
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            aspect-ratio: 1;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.1);
        }

        .image-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-container:hover .image-overlay {
            opacity: 1;
        }

        .social-card {
            opacity: 0.5;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .social-card.active {
            opacity: 1;
            transform: translateY(0);
        }

        .social-link {
            display: block;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            transform: translateX(10px);
            color: var(--bright-pink);
        }

        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        /* ÊúâË∂£ÁöÑ‰∫ãÈ°µÈù¢Ê†∑Âºè */
        .maze-container {
            background: var(--lighter-yellow);
            padding: 3rem;
            border-radius: 1.5rem;
            margin: 2rem auto;
            max-width: 600px;
            text-align: center;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #maze {
            display: grid;
            gap: 2px;
            background: #ddd;
            padding: 15px;
            border-radius: 15px;
            margin: 1rem auto;
            width: 100%;
            height: 100%;
            aspect-ratio: 1;
        }

        .maze-cell {
            width: 100%;
            height: 100%;
            background: white;
            transition: all 0.3s ease;
            border-radius: 5px;
            min-width: 0;
            min-height: 0;
        }

        .wall { 
            background: var(--dark-green);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .path { 
            background: var(--soft-pink);
            box-shadow: inset 0 0 5px rgba(255,255,255,0.5);
        }

        .start { 
            background: var(--light-green);
            box-shadow: 0 0 15px rgba(76,175,80,0.3);
        }

        .end { 
            background: var(--bright-pink);
            box-shadow: 0 0 15px rgba(255,105,180,0.3);
        }

        .cat { 
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="%23808080"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="%23808080"/><path d="M6,3 h4 v1 h-4 z" fill="%23808080"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="%23808080"/><circle cx="6" cy="8" r="1" fill="white"/><circle cx="10" cy="8" r="1" fill="white"/><path d="M7,10 h2 v1 h-2 z" fill="white"/></svg>') no-repeat center/contain;
            background-size: 80%;
            animation: catBounce 0.3s ease;
        }

        @keyframes catBounce {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #mazeInfo {
            font-size: 1.2rem;
            margin: 1.5rem 0;
            color: var(--dark-green);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .maze-container .adopt-button {
            font-size: 1.1rem;
            padding: 0.8rem 2rem;
            margin-top: 2rem;
            background: var(--dark-green);
            color: white;
            border: none;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .maze-container .adopt-button:hover {
            background: var(--bright-pink);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .pet-garden {
            text-align: center;
            margin: 2rem auto;
            max-width: 800px;
        }

        .pet-card {
            display: inline-block;
            margin: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            text-align: center;
        }

        .pet-card:hover {
            transform: translateY(-5px);
        }

        .pet-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            background-size: contain;
            image-rendering: pixelated;
            background-repeat: no-repeat;
            background-position: center;
            border: 2px solid #E8F5E9;
            border-radius: 10px;
            padding: 10px;
        }

        .pet-name {
            color: var(--dark-green);
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }

        .adopt-button {
            background: var(--dark-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .adopt-button:hover {
            background: var(--bright-pink);
            transform: scale(1.05);
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .modal-overlay.show {
            opacity: 1;
        }

        .modal {
            background: var(--lighter-yellow);
            padding: 2rem;
            border-radius: 1rem;
            position: relative;
            max-width: 900px;
            width: 90%;
            margin: 2rem auto;
            text-align: center;
        }

        .pet-cards-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: nowrap;
        }

        .pet-card {
            flex: 1;
            min-width: 200px;
            max-width: 250px;
            margin: 0;
            padding: 1.5rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            text-align: center;
        }

        .pet-card:hover {
            transform: translateY(-5px);
        }

        .modal .close-button {
            margin-top: 2rem;
            padding: 0.5rem 2rem;
            font-size: 1.1rem;
        }

        /* ÂÆ†Áâ©Áä∂ÊÄÅÈù¢Êùø */
        .pet-status {
            position: fixed;
            top: 5rem;
            right: 2rem;
            background: rgba(255, 248, 225, 0.9);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(5px);
            z-index: 100;
            width: 250px;
        }

        .pet-status.show {
            display: block;
        }

        .status-bar {
            width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .status-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .happiness-bar { background: var(--bright-pink); }
        .hunger-bar { background: var(--light-green); }

        .pet-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .pet-action-btn {
            background: var(--dark-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pet-action-btn:hover {
            background: var(--bright-pink);
            transform: scale(1.05);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confetti-fall 3s linear forwards;
        }

        /* ‰øÆÊîπÊ†ë‰∏õÂä®ÁîªÊ†∑Âºè */
        .bush-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1B5E20;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease;
        }

        .bush-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* ‰øÆÊîπÂè∂Â≠êÊ†∑Âºè */
        .bush-leaf {
            position: absolute;
            width: 60px;
            height: 60px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,50 m-45,0 a45,45 0 1,0 90,0 a45,45 0 1,0 -90,0" fill="%234CAF50"/></svg>') no-repeat;
            background-size: contain;
            transform-origin: center;
            transition: transform 0.5s ease;
            border-radius: 50%;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .bush-leaf.light {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,50 m-45,0 a45,45 0 1,0 90,0 a45,45 0 1,0 -90,0" fill="%2381C784"/></svg>') no-repeat;
            background-size: contain;
        }

        .bush-leaf.dark {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,50 m-45,0 a45,45 0 1,0 90,0 a45,45 0 1,0 -90,0" fill="%232E7D32"/></svg>') no-repeat;
            background-size: contain;
        }

        .bush-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 32px;
            text-align: center;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            opacity: 0;
            animation: fadeIn 1s ease forwards;
        }

        .bush-text span {
            display: block;
            margin-top: 15px;
            font-size: 20px;
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .bush.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Ê∑ªÂä†ÁïôË®ÄËä±Âõ≠Ê†∑Âºè */
        .message-garden {
            position: relative;
            padding: 2.5rem;
            background: var(--lighter-yellow);
            border-radius: 1rem;
            margin: 2rem auto;
            max-width: 800px;
        }

        .message-form {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message-input {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 2px solid #E8F5E9;
            border-radius: 0.5rem;
            resize: vertical;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--light-green);
        }

        .send-button {
            background: var(--light-green);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 2rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .send-button:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
        }

        .mailbox {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--lighter-yellow);
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .mailbox:hover {
            transform: translateY(-5px);
        }

        .mailbox-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--bright-pink);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .flower {
            position: absolute;
            width: 30px;
            height: 30px;
            animation: flowerFloat 3s ease-in-out infinite;
        }

        @keyframes flowerFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .messages-modal {
            position: fixed;
            bottom: 80px;
            right: 2rem;
            width: 300px;
            max-height: 400px;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            display: none;
            z-index: 99;
        }

        .message-item {
            padding: 1rem;
            border-bottom: 1px solid #E8F5E9;
        }

        .message-time {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.5rem;
        }

        /* Ê∑ªÂä†ÁßòÂØÜËä±Âõ≠ËÉåÊôØÂä®Áîª */
        .garden-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* Ëó§ËîìÊ†∑Âºè */
        .vine {
            position: absolute;
            width: 3px;
            background: linear-gradient(to bottom, #4CAF50, #81C784);
            transform-origin: top;
            animation: vineGrow 3s ease-out forwards;
            opacity: 0.8;
            z-index: 1;
        }

        .vine::after {
            content: 'üçÉ';
            position: absolute;
            bottom: -10px;
            left: -10px;
            font-size: 20px;
            animation: leafSway 3s ease-in-out infinite;
        }

        /* Ëä±ÊúµÊ†∑Âºè */
        .garden-flower {
            position: absolute;
            font-size: 24px;
            animation: flowerBloom 2s ease-out forwards;
            opacity: 0.9;
            z-index: 2;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .garden-flower.red { content: 'üåπ'; }
        .garden-flower.pink { content: 'üå∏'; }
        .garden-flower.yellow { content: 'üåº'; }
        .garden-flower.white { content: 'üå∫'; }

        /* Ëù¥Ëù∂Ê†∑Âºè */
        .butterfly {
            position: absolute;
            font-size: 20px;
            animation: butterflyFly 20s linear infinite;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            z-index: 3;
        }

        /* ËÉåÊôØÊ∏êÂèò */
        .page {
            position: relative;
            background: none;
        }

        .page::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600"><defs><linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23FFE4E8"/><stop offset="100%" style="stop-color:%23FFF0F2"/></linearGradient></defs><rect width="100%" height="100%" fill="url(%23skyGradient)"/><path d="M500,100 L550,200 L600,150 L650,200 L700,150 L750,200 L800,150 L850,200 L900,150 L950,200 L1000,150 L1000,600 L0,600 L0,150 L50,200 L100,150 L150,200 L200,150 L250,200 L300,150 L350,200 L400,150 L450,200 L500,100 Z" fill="%23F8D7DA" opacity="0.3"/><path d="M480,250 l40,-60 l40,60 l-30,-10 l0,60 l-20,0 l0,-60 Z" fill="%23FFB6C1"/><circle cx="500" cy="220" r="15" fill="%23FFB6C1"/></svg>');
            background-size: cover;
            background-position: center;
            opacity: 0.4;
            z-index: -2;
        }

        /* Ê∑ªÂä†Ê†ëÊú®Ë£ÖÈ•∞ */
        .page::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 300"><path d="M0,300 C100,200 200,250 300,200 C400,150 500,200 600,150 C700,100 800,150 900,100 C950,75 975,100 1000,50 L1000,300 L0,300 Z" fill="%238BC34A" opacity="0.2"/><path d="M50,300 C150,250 250,280 350,240 C450,200 550,250 650,200 C750,150 850,200 950,150 L1000,300 L50,300 Z" fill="%234CAF50" opacity="0.15"/></svg>');
            background-size: cover;
            background-position: bottom;
            z-index: -1;
        }

        /* Âä®ÁîªÂÖ≥ÈîÆÂ∏ß */
        @keyframes vineGrow {
            from {
                height: 0;
                opacity: 0;
            }
            to {
                height: var(--vine-height);
            opacity: 1;
            }
        }

        @keyframes leafSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes flowerBloom {
            0% {
                transform: scale(0) rotate(-45deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes butterflyFly {
            0% {
                transform: translate(-10vw, 110vh) rotate(0deg);
            }
            25% {
                transform: translate(30vw, 50vh) rotate(-20deg);
            }
            50% {
                transform: translate(60vw, 80vh) rotate(0deg);
            }
            75% {
                transform: translate(90vw, 30vh) rotate(20deg);
            }
            100% {
                transform: translate(110vw, -10vh) rotate(0deg);
            }
        }

        /* Ê∑ªÂä†ÊµÅÂä®Ê†ëÂè∂ËÉåÊôØ */
        .floating-leaves {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .floating-leaf {
            position: absolute;
            width: 40px;
            height: 40px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,5 Q80,40 50,95 Q20,40 50,5" fill="%234CAF50"/></svg>') no-repeat center/contain;
            animation: floatLeaf 15s linear infinite;
        }

        @keyframes floatLeaf {
            0% {
                transform: translate(-100px, -100px) rotate(0deg);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% {
                transform: translate(calc(100vw + 100px), calc(100vh + 100px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Ê∑ªÂä†Âä®ÊÄÅÂ∞èÁå´Ê†∑Âºè */
        .active-pet {
            position: absolute;
            width: 60px;
            height: 60px;
            pointer-events: none;
            z-index: 10;
            transition: all 0.5s ease;
            image-rendering: pixelated;
        }

        .active-pet.gray {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="%23808080"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="%23808080"/><path d="M6,3 h4 v1 h-4 z" fill="%23808080"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="%23808080"/><circle cx="6" cy="8" r="1" fill="white"/><circle cx="10" cy="8" r="1" fill="white"/><path d="M7,10 h2 v1 h-2 z" fill="white"/></svg>') no-repeat center/contain;
        }

        .active-pet.orange {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="%23FFA500"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="%23FFA500"/><path d="M6,3 h4 v1 h-4 z" fill="%23FFA500"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="%23FFA500"/><circle cx="6" cy="8" r="1" fill="white"/><circle cx="10" cy="8" r="1" fill="white"/><path d="M7,10 h2 v1 h-2 z" fill="white"/></svg>') no-repeat center/contain;
        }

        .active-pet.white {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="white"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="white"/><path d="M6,3 h4 v1 h-4 z" fill="white"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="white"/><circle cx="6" cy="8" r="1" fill="%23666"/><circle cx="10" cy="8" r="1" fill="%23666"/><path d="M7,10 h2 v1 h-2 z" fill="%23666"/></svg>') no-repeat center/contain;
        }

        .active-pet.sleeping {
            animation: breathe 3s ease-in-out infinite;
        }

        .active-pet.playing {
            animation: bounce 0.5s ease-in-out infinite alternate;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes bounce {
            0% { transform: translateY(0) rotate(-5deg); }
            100% { transform: translateY(-10px) rotate(5deg); }
        }

        /* ÂõæÁâáÂ±ïÁ§∫Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .image-modal {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            max-width: 60%;  /* ÂáèÂ∞èÊúÄÂ§ßÂÆΩÂ∫¶ */
            max-height: 70vh;  /* ÂáèÂ∞èÊúÄÂ§ßÈ´òÂ∫¶ */
            margin: 15vh auto;  /* Ë∞ÉÊï¥‰∏äËæπË∑ù */
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .image-modal .image-container {
            margin: 15px 0;
            max-height: 50vh;  /* ÂáèÂ∞èÂõæÁâáÂÆπÂô®ÊúÄÂ§ßÈ´òÂ∫¶ */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;  /* Á°Æ‰øùÂÆπÂô®Âç†Êª°Ê®°ÊÄÅÊ°ÜÂÆΩÂ∫¶ */
        }

        .image-modal .image-container img {
            max-width: 100%;
            max-height: 50vh;  /* ÂáèÂ∞èÂõæÁâáÊúÄÂ§ßÈ´òÂ∫¶ */
            object-fit: contain;
            border-radius: 10px;
            transition: transform 0.3s ease;
            margin: 0 auto;  /* Á°Æ‰øùÂõæÁâáÊ∞¥Âπ≥Â±Ö‰∏≠ */
        }

        .image-modal .image-navigation {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .image-modal .image-navigation button {
            background: var(--dark-green);
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .image-modal .image-navigation button:hover {
            background: var(--bright-pink);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* ÂºπÂπïÊ†∑Âºè */
        .danmaku-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .danmaku {
            position: absolute;
            white-space: nowrap;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-size: 20px;
            animation: danmaku-move 8s linear;
            pointer-events: none;
        }

        @keyframes danmaku-move {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        /* Ë£ÖÈ•∞Ëä±ÊúµÊ†∑Âºè */
        .modal-flower {
            position: absolute;
            font-size: 20px;  /* ÂáèÂ∞èËä±ÊúµÂ§ßÂ∞è */
            pointer-events: none;
            animation: flowerFloat 3s ease-in-out infinite;
        }

        /* Ë£ÖÈ•∞Ëù¥Ëù∂Ê†∑Âºè */
        .modal-butterfly {
            position: absolute;
            font-size: 16px;  /* ÂáèÂ∞èËù¥Ëù∂Â§ßÂ∞è */
            pointer-events: none;
            animation: butterflyFloat 4s ease-in-out infinite;
        }

        @keyframes flowerFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(10px, -10px) rotate(5deg); }
        }

        @keyframes butterflyFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(15px, -15px) rotate(15deg); }
            50% { transform: translate(0, -20px) rotate(0deg); }
            75% { transform: translate(-15px, -15px) rotate(-15deg); }
        }

        /* ÂºπÂπïËæìÂÖ•Ê°ÜÊ†∑Âºè */
        .danmaku-input-container {
            position: absolute;
            bottom: 10px;  /* Ë∞ÉÊï¥Â∫ïÈÉ®Ë∑ùÁ¶ª */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;  /* ÂáèÂ∞èÂÜÖËæπË∑ù */
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;  /* Á°Æ‰øùËæìÂÖ•Ê°ÜÂú®ÊúÄ‰∏äÂ±Ç */
        }

        .danmaku-input {
            border: 2px solid var(--bright-pink);
            border-radius: 15px;
            padding: 4px 8px;  /* ÂáèÂ∞èËæìÂÖ•Ê°ÜÂÜÖËæπË∑ù */
            width: 180px;  /* ÂáèÂ∞èËæìÂÖ•Ê°ÜÂÆΩÂ∫¶ */
            outline: none;
        }

        .danmaku-send {
            background: var(--bright-pink);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .danmaku-send:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
        }

        /* ÁÇπËµûÊåâÈíÆÊ†∑Âºè */
        .like-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 2px solid var(--bright-pink);
            color: var(--bright-pink);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            z-index: 2;
        }

        .like-button:hover {
            background: var(--bright-pink);
            color: white;
            transform: translateY(-2px);
        }

        .like-button.liked {
            background: var(--bright-pink);
            color: white;
        }

        .like-count {
            font-weight: bold;
        }

        /* ÁÇπËµûÂä®ÁîªÊïàÊûú */
        @keyframes likeAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .like-button.liked .heart-icon {
            animation: likeAnimation 0.3s ease;
        }

        .heart-icon {
            font-size: 16px;
        }

        /* ÁÇπËµûÁ≤íÂ≠êÊïàÊûú */
        .like-particle {
            position: absolute;
            pointer-events: none;
            animation: particleFloat 1s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px) scale(0);
                opacity: 0;
            }
        }

        /* Âà†Èô§AIÂØπËØùÁ™óÂè£Ê†∑Âºè */
        .ai-chat-container,
        .ai-chat-header,
        .ai-chat-controls,
        .ai-chat-messages,
        .chat-message,
        .message-avatar,
        .message-content,
        .ai-chat-input,
        .input-container,
        .voice-wave {
            display: none;
        }

        /* Âà†Èô§ËØ≠Èü≥Ê≥¢ÂΩ¢Âä®Áîª */
        @keyframes waveAnimation {
            0%, 100% { height: 20%; }
            50% { height: 100%; }
        }

        /* AIÂØπËØùÊ†èÊ†∑Âºè */
        .ai-chat-bar {
            position: fixed;
            bottom: 0;
            left: 20px;  /* ‰ªérightÊîπ‰∏∫left */
            width: 350px;
            background: white;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--dark-green);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .ai-chat-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .toggle-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .ai-chat-content {
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .ai-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
        }

        .ai-message {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .ai-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--dark-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 12px;
        }

        .ai-text {
            background: white;
            padding: 10px;
            border-radius: 15px;
            max-width: 80%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .user-avatar {
            background: var(--bright-pink);
            margin-right: 0;
            margin-left: 10px;
        }

        .user-text {
            background: var(--bright-pink);
            color: white;
        }

        .ai-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .ai-input-container input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-send-button {
            background: var(--dark-green);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-send-button:hover {
            background: var(--bright-pink);
        }

        .ai-chat-bar.minimized .ai-chat-content {
            display: none;
        }

        .ai-chat-bar.minimized {
            height: auto;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #aaa;
            border-radius: 50%;
            margin-right: 5px;
            animation: typing 1s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* ËøîÂõûÊåâÈíÆÊ†∑Âºè */
        .back-to-cover {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: var(--bright-pink);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-to-cover:hover {
            background-color: var(--light-green);
            transform: translateY(-2px);
        }

        .back-to-cover:active {
            transform: translateY(1px);
        }

        /* ÈöêËóèÂØºËà™Ê†è */
        .navigation {
            display: none;
        }

        .active-pet {
            position: fixed;
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.5s ease;
        }
        
        .active-pet.sleeping {
            animation: breathe 3s ease-in-out infinite;
        }
        
        .active-pet.playing {
            animation: bounce 0.5s ease-in-out infinite alternate;
        }
        
        .pet-interaction-options {
            position: fixed;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
        }
        
        .pet-interaction-options button {
            margin: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            background: var(--dark-green);
            color: white;
            cursor: pointer;
        }
        
        .pet-interaction-options button:hover {
            background: var(--bright-pink);
        }
        
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes bounce {
            0% { transform: translateY(0) rotate(-5deg); }
            100% { transform: translateY(-10px) rotate(5deg); }
        }

        .pet-interaction-options {
            position: fixed;
            background: white;
            border: 2px solid var(--dark-green);
            border-radius: 10px;
            padding: 10px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .interaction-option {
            padding: 8px 15px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .interaction-option:hover {
            background-color: var(--soft-pink);
        }
        
        .active-pet.playing {
            animation: play 2s infinite;
        }
        
        .active-pet.eating {
            animation: eat 2s infinite;
        }
        
        @keyframes play {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes eat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .celebration-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .congrats-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: bounce 1s infinite;
        }

        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            background: radial-gradient(circle, #FFD700, #FF4500);
            border-radius: 50%;
            animation: explode 1s forwards;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: fall 2s linear forwards;
        }

        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(20); opacity: 0; }
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        .gesture-feedback {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            z-index: 1000;
            display: none;
        }
        
        .gesture-feedback.show {
            display: block;
            animation: fadeInOut 2s forwards;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .maze-celebration-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }

        .maze-congrats-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1001;
        }

        .maze-congrats-title {
            font-size: 64px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        .maze-congrats-subtitle {
            font-size: 24px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .maze-firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: mazeExplode 1.5s forwards;
        }

        .maze-confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: mazeFall 3s linear forwards;
        }

        .maze-confetti.circle {
            border-radius: 50%;
        }

        .maze-confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid currentColor;
            background: none;
        }

        .maze-star {
            position: fixed;
            background: #FFD700;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: mazeTwinkle 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes mazeExplode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(30); opacity: 0; }
        }

        @keyframes mazeFall {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        @keyframes mazeTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .maze-confetti {
            position: fixed;
            top: -20px;
            pointer-events: none;
            animation: mazeFall 5s linear forwards;
        }

        .maze-confetti.circle {
            border-radius: 50%;
        }

        .maze-confetti.square {
            border-radius: 2px;
        }

        .maze-confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid currentColor;
            background: none;
        }

        .maze-confetti.spiral {
            background: none;
            border: 2px solid;
            border-radius: 50%;
            animation: mazeFallSpiral 5s linear forwards;
        }

        .maze-confetti.glitter {
            background: radial-gradient(circle at center, currentColor 30%, transparent 70%);
            animation: mazeFallGlitter 5s linear forwards;
        }

        .maze-confetti.ribbon {
            height: 2px;
            width: 20px;
            background: linear-gradient(90deg, currentColor, transparent);
            animation: mazeFallRibbon 5s linear forwards;
        }

        @keyframes mazeFall {
            0% { 
                transform: translateY(-20px) rotate(0deg); 
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes mazeFallSpiral {
            0% { 
                transform: translateY(-20px) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh) rotate(1080deg) scale(0.5);
                opacity: 0;
            }
        }

        @keyframes mazeFallGlitter {
            0% { 
                transform: translateY(-20px) rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotate(180deg) scale(1.2);
                opacity: 0.8;
            }
            100% { 
                transform: translateY(100vh) rotate(360deg) scale(0.8);
                opacity: 0;
            }
        }

        @keyframes mazeFallRibbon {
            0% { 
                transform: translateY(-20px) rotate(0deg) scaleX(1);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotate(180deg) scaleX(1.5);
                opacity: 0.8;
            }
            100% { 
                transform: translateY(100vh) rotate(360deg) scaleX(1);
                opacity: 0;
            }
        }

        .tag-cloud {
            position: relative;
            height: 400px;
            width: 100%;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tag {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
            line-height: 1.2;
            word-break: break-word;
            animation: floatAnimation 3s infinite ease-in-out;
            transform-origin: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease;
        }

        .tag-text {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .like-count {
            background: var(--bright-pink);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .tag:hover {
            transform: scale(1.1);
        }

        .tag:hover .like-count {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes countBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .heart {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--bright-pink);
            transform: rotate(45deg);
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }

        .heart::before,
        .heart::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--bright-pink);
            border-radius: 50%;
        }

        .heart::before {
            top: -12px;
            left: 0;
        }

        .heart::after {
            top: 0;
            left: -12px;
        }

        @keyframes heartFloat {
            0% {
                transform: rotate(45deg) translateY(0) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: rotate(45deg) translateY(-50px) scale(1.2);
                opacity: 0;
            }
        }

        @keyframes countAnimation {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .tag:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .tag:nth-child(2) { left: 30%; top: 10%; animation-delay: 0.4s; }
        .tag:nth-child(3) { left: 50%; top: 20%; animation-delay: 0.8s; }
        .tag:nth-child(4) { left: 70%; top: 10%; animation-delay: 1.2s; }
        .tag:nth-child(5) { left: 20%; top: 60%; animation-delay: 1.6s; }
        .tag:nth-child(6) { left: 40%; top: 70%; animation-delay: 2s; }
        .tag:nth-child(7) { left: 60%; top: 60%; animation-delay: 2.4s; }
        .tag:nth-child(8) { left: 80%; top: 70%; animation-delay: 2.8s; }

        @keyframes floatAnimation {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            aspect-ratio: 1;
        }

        .photo-item:hover {
            transform: scale(1.02);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: var(--bright-pink);
            font-size: 18px;
        }

        .photo-item:hover .delete-btn {
            opacity: 1;
        }

        .photo-item .delete-btn:hover {
            background: var(--bright-pink);
            color: white;
        }

        .photo-date {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px;
            text-align: center;
            font-size: 12px;
            color: var(--dark-green);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .photo-item:hover .photo-date {
            opacity: 1;
        }

        @keyframes floatEmoji {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(10deg);
            }
        }

        .floating-emoji {
            position: absolute;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .photo-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* Ê∑ªÂä†Âà∞Â∑≤ÊúâÁöÑÊ†∑Âºè‰∏≠ */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #generateDogBtn:hover {
            transform: scale(1.05);
            background-color: var(--dark-green);
        }

        .dog-image-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Â∞ÅÈù¢È°µÈù¢ -->
    <div class="cover-page" id="coverPage">
        <div class="cover-text">
            <div class="chinese-text">‰Ω†Áúº‰∏≠ÁöÑÊàëÔºü</div>
            <div class="english-text">Which one do you want to know about me</div>
        </div>
        <div class="click-area camera-area" onclick="navigateTo('home')">
            <img src="public/Áõ∏Êú∫.jpg" alt="ÁÖßÁõ∏Êú∫">
            <span>È¶ñÈ°µ</span>
        </div>
        <div class="click-area cat-area" onclick="navigateTo('fun')">
            <img src="public/Â∞èÁå´.jpg" alt="Â∞èÁå´">
            <span>ÊúâË∂£ÁöÑ‰∫ã</span>
        </div>
        <div class="click-area notebook-area" onclick="navigateTo('contact')">
            <img src="public/Êú¨Â≠ê.jpg" alt="Êú¨Â≠ê">
            <span>ËÅîÁ≥ªÊàë</span>
        </div>
        <div class="click-area palette-area" onclick="navigateTo('about')">
            <img src="public/ÁîªÁ¨î.jpg" alt="Ë∞ÉËâ≤Áõò">
            <span>ÂÖ≥‰∫éÊàë</span>
        </div>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <div class="main-content" id="mainContent">
        <button class="back-to-cover" onclick="backToCover()">ËøîÂõûÂ∞ÅÈù¢</button>
        <div class="page" id="home">
            <div class="floating-leaves" id="floatingLeaves"></div>
            <div class="container">
                <section class="welcome-section">
                    <h1 class="welcome-title">Life is like<br>a box<br>collecting happiness</h1>
                    <div class="category-text">
                        <span>ÁîüÊ¥ª</span>
                        <span>Ëá™Êàë</span>
                        <span>ÊóÖË°å</span>
                    </div>
                </section>
                
                <div class="life-gallery">
                    <!-- ÁîüÊ¥ªÁÖßÁâá -->
                    <div class="gallery-item">
                        <img src="public/day.jpg" alt="Êó•Â∏∏ÁîüÊ¥ª">
                        <div class="gallery-category">ÁîüÊ¥ª</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">Ê∏©È¶®Êó•Â∏∏</h3>
                            <p class="gallery-description">ËÆ∞ÂΩïÁîüÊ¥ª‰∏≠ÁöÑÁæéÂ•ΩÊó∂Âàª</p>
                        </div>
                    </div>
                    
                    <!-- Ëá™ÊàëÂ±ïÁ§∫ -->
                    <div class="gallery-item">
                        <img src="public/xiezhen.jpg" alt="‰∏™‰∫∫ÂÜôÁúü">
                        <div class="gallery-category">Ëá™Êàë</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">‰∏™‰∫∫ÂÜôÁúü</h3>
                            <p class="gallery-description">Â±ïÁé∞ÊúÄÁúüÂÆûÁöÑËá™Â∑±</p>
                        </div>
                    </div>
                    
                    <!-- ÊóÖË°åÁÖßÁâá -->
                    <div class="gallery-item">
                        <img src="public/travel.jpg" alt="ÊóÖË°å">
                        <div class="gallery-category">ÊóÖË°å</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">ÊóÖË°åË∂≥Ëøπ</h3>
                            <p class="gallery-description">Êé¢Á¥¢‰∏ñÁïåÁöÑÊØè‰∏Ä‰∏™ËßíËêΩ</p>
                        </div>
                    </div>
                    
                    <!-- Êõ¥Â§öÁîüÊ¥ªÁÖßÁâá -->
                    <div class="gallery-item">
                        <img src="public/food.jpg" alt="ÁæéÈ£ü">
                        <div class="gallery-category">ÁæéÈ£ü</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">ÁæéÈ£üËÆ∞ÂΩï</h3>
                            <p class="gallery-description">ÂìÅÂë≥ÁîüÊ¥ª‰∏≠ÁöÑÁæéÂë≥</p>
                        </div>
                    </div>
                    
                    <!-- Êõ¥Â§öËá™ÊàëÂ±ïÁ§∫ -->
                    <div class="gallery-item">
                        <img src="public/like.jpg" alt="ÂÖ¥Ë∂£Áà±Â•Ω">
                        <div class="gallery-category">ÂÖ¥Ë∂£</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">ÂÖ¥Ë∂£Áà±Â•Ω</h3>
                            <p class="gallery-description">ÂàÜ‰∫´ÊàëÁöÑÂø´‰πêÊ∫êÊ≥â</p>
                        </div>
                    </div>
                    
                    <!-- Êõ¥Â§öÊóÖË°åÁÖßÁâá -->
                    <div class="gallery-item">
                        <img src="public/fengjing.jpg" alt="È£éÊôØ">
                        <div class="gallery-category">È£éÊôØ</div>
                        <div class="gallery-overlay">
                            <h3 class="gallery-title">È£éÊôØÊé†ÂΩ±</h3>
                            <p class="gallery-description">ÂÆöÊ†ºÁæé‰∏ΩÁöÑÁû¨Èó¥</p>
                        </div>
                    </div>
                </div>

                <div class="memory-section" style="margin-top: 40px; text-align: center; padding: 30px; background: rgba(255, 255, 255, 0.9); border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                    <h2 class="text-dark-green" style="margin-bottom: 20px;">Áïô‰∏ã‰Ω†ÁöÑ‰∏ìÂ±ûËÆ∞ÂøÜ</h2>
                    
                    <div class="camera-options" style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px;">
                        <div class="camera-container" style="position: relative; display: inline-block; cursor: pointer;" onclick="handlePhotoUpload()">
                            <div class="camera-icon" style="font-size: 48px; color: var(--dark-green); animation: float 2s infinite ease-in-out;">üì∏</div>
                            <div class="camera-text" style="margin-top: 15px; color: var(--dark-green); font-size: 1.1rem;">‰∏ä‰º†ÁÖßÁâá</div>
                            <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoChange(event)">
                        </div>

                        <div class="camera-container" style="position: relative; display: inline-block; cursor: pointer;" onclick="startCamera()">
                            <div class="camera-icon" style="font-size: 48px; color: var(--dark-green); animation: float 2s infinite ease-in-out;">üé•</div>
                            <div class="camera-text" style="margin-top: 15px; color: var(--dark-green); font-size: 1.1rem;">ÊâìÂºÄÁõ∏Êú∫</div>
                        </div>
                    </div>

                    <!-- Áõ∏Êú∫È¢ÑËßàÂíåÁÖßÁâáÈ¢ÑËßàÂå∫Âüü -->
                    <div id="previewSection" style="display: none; margin-top: 20px;">
                        <video id="cameraPreview" autoplay playsinline style="display: none; max-width: 100%; height: 300px; border-radius: 10px;"></video>
                        <img id="photoPreview" style="display: none; max-width: 100%; height: 300px; object-fit: contain; border-radius: 10px;">
                        
                        <div class="preview-controls" style="margin-top: 15px;">
                            <button id="captureBtn" onclick="capturePhoto()" style="display: none; background: var(--dark-green); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 0 10px;">ÊãçÁÖß</button>
                            <button id="retakeBtn" onclick="retakePhoto()" style="display: none; background: var(--bright-pink); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 0 10px;">ÈáçÊãç</button>
                            <button id="saveBtn" onclick="savePhoto()" style="display: none; background: var(--dark-green); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 0 10px;">‰øùÂ≠òÁÖßÁâá</button>
                        </div>
                    </div>

                    <!-- ‰øùÂ≠òÁöÑÁÖßÁâáÂ±ïÁ§∫Âå∫Âüü -->
                    <div class="saved-photos" style="margin-top: 30px;">
                        <h3 class="text-dark-green" style="margin-bottom: 15px; display: none;" id="savedPhotosTitle">ÊàëÁöÑÁÖßÁâáÂ¢ô</h3>
                        <div id="photoWall" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <!-- ÁÖßÁâáÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÊ∑ªÂä† -->
                        </div>
                    </div>
                </div>

                <style>
                    @keyframes float {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                    
                    .camera-container:hover .camera-icon {
                        transform: scale(1.1);
                    }
                    
                    .camera-container:hover .camera-text {
                        color: var(--bright-pink) !important;
                    }
                    
                    .camera-icon {
                        transition: transform 0.3s ease;
                    }
                    
                    .camera-text {
                        transition: color 0.3s ease;
                    }

                    .preview-controls button:hover {
                        opacity: 0.9;
                        transform: scale(1.05);
                    }

                    .preview-controls button {
                        transition: all 0.3s ease;
                    }
                </style>

                <script>
                    // Â∞ÜstreamÂèòÈáèÂ£∞ÊòéÁßªÂä®Âà∞ÂÖ®Â±Ä‰ΩúÁî®Âüü
                    window.cameraStream = null;
                    
                    function handlePhotoUpload() {
                        document.getElementById('photoInput').click();
                    }

                    function handlePhotoChange(event) {
                        const file = event.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const previewSection = document.getElementById('previewSection');
                                const photoPreview = document.getElementById('photoPreview');
                                const saveBtn = document.getElementById('saveBtn');
                                
                                photoPreview.src = e.target.result;
                                photoPreview.style.display = 'block';
                                previewSection.style.display = 'block';
                                saveBtn.style.display = 'inline-block';
                                
                                // ÈöêËóèÁõ∏Êú∫È¢ÑËßà
                                document.getElementById('cameraPreview').style.display = 'none';
                                document.getElementById('captureBtn').style.display = 'none';
                            }
                            reader.readAsDataURL(file);
                        }
                    }

                    async function startCamera() {
                        try {
                            if (window.cameraStream) {
                                window.cameraStream.getTracks().forEach(track => track.stop());
                            }
                            window.cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                            const previewSection = document.getElementById('previewSection');
                            const cameraPreview = document.getElementById('cameraPreview');
                            const captureBtn = document.getElementById('captureBtn');
                            
                            cameraPreview.srcObject = window.cameraStream;
                            previewSection.style.display = 'block';
                            cameraPreview.style.display = 'block';
                            captureBtn.style.display = 'inline-block';
                            
                            // ÈöêËóèÁÖßÁâáÈ¢ÑËßà
                            document.getElementById('photoPreview').style.display = 'none';
                            document.getElementById('saveBtn').style.display = 'none';
                        } catch (err) {
                            alert('Êó†Ê≥ïËÆøÈóÆÊëÑÂÉèÂ§¥Ôºö' + err.message);
                        }
                    }

                    function capturePhoto() {
                        const cameraPreview = document.getElementById('cameraPreview');
                        const photoPreview = document.getElementById('photoPreview');
                        const canvas = document.createElement('canvas');
                        
                        canvas.width = cameraPreview.videoWidth;
                        canvas.height = cameraPreview.videoHeight;
                        canvas.getContext('2d').drawImage(cameraPreview, 0, 0);
                        
                        photoPreview.src = canvas.toDataURL('image/jpeg');
                        photoPreview.style.display = 'block';
                        cameraPreview.style.display = 'none';
                        
                        // ÊòæÁ§∫ÈáçÊãçÂíå‰øùÂ≠òÊåâÈíÆ
                        document.getElementById('captureBtn').style.display = 'none';
                        document.getElementById('retakeBtn').style.display = 'inline-block';
                        document.getElementById('saveBtn').style.display = 'inline-block';
                    }

                    function retakePhoto() {
                        const cameraPreview = document.getElementById('cameraPreview');
                        const photoPreview = document.getElementById('photoPreview');
                        
                        cameraPreview.style.display = 'block';
                        photoPreview.style.display = 'none';
                        
                        // ÊòæÁ§∫ÊãçÁÖßÊåâÈíÆÔºåÈöêËóèÈáçÊãçÂíå‰øùÂ≠òÊåâÈíÆ
                        document.getElementById('captureBtn').style.display = 'inline-block';
                        document.getElementById('retakeBtn').style.display = 'none';
                        document.getElementById('saveBtn').style.display = 'none';
                    }

                    function savePhoto() {
                        const photoPreview = document.getElementById('photoPreview');
                        const photoWall = document.getElementById('photoWall');
                        const savedPhotosTitle = document.getElementById('savedPhotosTitle');
                        
                        // ÂàÜÊûêÁÖßÁâá‰∏≠ÁöÑË°®ÊÉÖ
                        analyzePhoto(photoPreview.src)
                            .then(emotions => {
                                const emojis = getEmotionEmojis(emotions);
                                
                                // ÂàõÂª∫Êñ∞ÁöÑÁÖßÁâáÂÖÉÁ¥†
                                const photoItem = document.createElement('div');
                                photoItem.className = 'photo-item';
                                
                                // ÁîüÊàêÂîØ‰∏ÄID
                                const photoId = 'photo_' + Date.now();
                                photoItem.id = photoId;
                                
                                // Ëé∑ÂèñÂΩìÂâçÊó•ÊúüÊó∂Èó¥
                                const now = new Date();
                                const dateStr = now.toLocaleDateString('zh-CN') + ' ' + 
                                             now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                                
                                // ËÆæÁΩÆÁÖßÁâáHTML
                                photoItem.innerHTML = `
                                    <div class="photo-container" style="position: relative; width: 100%; height: 100%;">
                                        <img src="${photoPreview.src}" alt="‰øùÂ≠òÁöÑÁÖßÁâá">
                                        <button class="delete-btn" onclick="deletePhoto('${photoId}')">√ó</button>
                                        <div class="photo-date">${dateStr}</div>
                                    </div>
                                `;
                                
                                // Ê∑ªÂä†Ë°®ÊÉÖË£ÖÈ•∞
                                const photoContainer = photoItem.querySelector('.photo-container');
                                createFloatingEmojis(photoContainer, emojis);
                                
                                // Ê∑ªÂä†Âà∞ÁÖßÁâáÂ¢ô
                                photoWall.insertBefore(photoItem, photoWall.firstChild);
                                savedPhotosTitle.style.display = 'block';
                                
                                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                                saveToLocalStorage(photoId, {
                                    src: photoPreview.src,
                                    date: dateStr,
                                    emojis: emojis
                                });
                                
                                // ÂÖ≥Èó≠Áõ∏Êú∫Âπ∂ÈáçÁΩÆÁïåÈù¢
                                if (window.cameraStream) {
                                    window.cameraStream.getTracks().forEach(track => track.stop());
                                    window.cameraStream = null;
                                }
                                
                                document.getElementById('previewSection').style.display = 'none';
                                document.getElementById('retakeBtn').style.display = 'none';
                                document.getElementById('saveBtn').style.display = 'none';
                                
                                // ÊòæÁ§∫‰øùÂ≠òÊàêÂäüÊèêÁ§∫
                                alert('ÁÖßÁâá‰øùÂ≠òÊàêÂäüÔºÅ');
                            })
                            .catch(error => {
                                console.error('Ë°®ÊÉÖËØÜÂà´Â§±Ë¥•:', error);
                                alert('ÁÖßÁâá‰øùÂ≠òÊàêÂäüÔºÅÔºàË°®ÊÉÖËØÜÂà´Â§±Ë¥•Ôºâ');
                            });
                    }

                    // ‰øÆÊîπÂä†ËΩΩ‰øùÂ≠òÁöÑÁÖßÁâáÁöÑÂáΩÊï∞
                    window.addEventListener('load', function() {
                        const savedPhotos = JSON.parse(localStorage.getItem('savedPhotos') || '{}');
                        const photoWall = document.getElementById('photoWall');
                        const savedPhotosTitle = document.getElementById('savedPhotosTitle');
                        
                        if (Object.keys(savedPhotos).length > 0) {
                            savedPhotosTitle.style.display = 'block';
                            
                            Object.entries(savedPhotos).forEach(([id, data]) => {
                                const photoItem = document.createElement('div');
                                photoItem.className = 'photo-item';
                                photoItem.id = id;
                                
                                photoItem.innerHTML = `
                                    <div class="photo-container" style="position: relative; width: 100%; height: 100%;">
                                        <img src="${data.src}" alt="‰øùÂ≠òÁöÑÁÖßÁâá">
                                        <button class="delete-btn" onclick="deletePhoto('${id}')">√ó</button>
                                        <div class="photo-date">${data.date}</div>
                                    </div>
                                `;
                                
                                // Â¶ÇÊûúÊúâË°®ÊÉÖÊï∞ÊçÆÔºåÊ∑ªÂä†Ë°®ÊÉÖË£ÖÈ•∞
                                if (data.emojis) {
                                    const photoContainer = photoItem.querySelector('.photo-container');
                                    createFloatingEmojis(photoContainer, data.emojis);
                                }
                                
                                photoWall.appendChild(photoItem);
                            });
                        }
                    });

                    function deletePhoto(photoId) {
                        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂº†ÁÖßÁâáÂêóÔºü')) {
                            const photoElement = document.getElementById(photoId);
                            if (photoElement) {
                                photoElement.remove();
                                removeFromLocalStorage(photoId);
                                
                                // Â¶ÇÊûúÊ≤°ÊúâÁÖßÁâá‰∫ÜÔºåÈöêËóèÊ†áÈ¢ò
                                const photoWall = document.getElementById('photoWall');
                                if (!photoWall.children.length) {
                                    document.getElementById('savedPhotosTitle').style.display = 'none';
                                }
                            }
                        }
                    }

                    function saveToLocalStorage(id, photoData) {
                        const savedPhotos = JSON.parse(localStorage.getItem('savedPhotos') || '{}');
                        savedPhotos[id] = photoData;
                        localStorage.setItem('savedPhotos', JSON.stringify(savedPhotos));
                    }

                    function removeFromLocalStorage(id) {
                        const savedPhotos = JSON.parse(localStorage.getItem('savedPhotos') || '{}');
                        delete savedPhotos[id];
                        localStorage.setItem('savedPhotos', JSON.stringify(savedPhotos));
                    }
                </script>
            </div>
        </div>

        <!-- ÂÖ≥‰∫éÈ°µÈù¢ -->
        <div id="about" class="page">
            <div class="garden-background" id="aboutGarden"></div>
            <div class="container">
                <div class="bg-lighter-yellow">
                    <h2 class="text-dark-green">ÂÖ≥‰∫éÊàë</h2>
                    <p class="text-dark-green" style="line-height: 1.6;">
                        HelloÔºÅ‰Ω†Â•ΩÂïäÔºÅÊàëÊòØÊùéËØóÊ∑ºÔºåÊòØ‰∏ÄÂêçÊù•Ëá™ÂÜÖËíôÂè§ÂåÖÂ§¥Â∏ÇÁöÑÂ§ßÂ≠¶ÁîüÔºåÁé∞Â∞±ËØª‰∫é<a href="https://www.bjtu.edu.cn" target="_blank" class="school-link">Âåó‰∫¨‰∫§ÈÄöÂ§ßÂ≠¶</a>Âª∫Á≠ë‰∏éËâ∫ÊúØÂ≠¶Èô¢ËßÜËßâ‰º†ËææËÆæËÆ°‰∏ì‰∏ö„ÄÇÊàëÊÄßÊ†ºÂºÄÊúóÔºåÁÉ≠Áà±ÁîüÊ¥ªÔºåÂñúÊ¨¢Ëá™Ë®ÄËá™ËØ≠Ôºå‰πüÂñúÊ¨¢ÂíåÊúãÂèãÂíåÊúãÂèãÁé©ÊäΩË±°ÔºåÊú¨‰∫∫ÂØπ‰∏úÁéÑË•øÁéÑÂçÅÂàÜÊÑüÂÖ¥Ë∂£ÔºåÂèØ‰ª•‰∏ÄËµ∑‰∫§ÊµÅËÆ®ËÆ∫Âì¶ÔºÅ
                    </p>
                    <p class="text-dark-green" style="margin-top: 1rem;">
                        Ê¨¢Ëøé‰Ω†Êù•Âà∞ÊàëÁöÑÂ∞èËä±Âõ≠ÔºÅÊúüÂæÖ‰Ω†ÁöÑÊµèËßà‰∏éÁïôË®Ä~
                    </p>
                </div>

                <div class="grid">
                    <div id="personalityCard" class="bg-lighter-yellow hover-glow cursor-pointer">
                        <h2 class="text-bright-pink" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            Â§ÑÂ•≥Â∫ßINFJ
                            <span id="toggleText" style="font-size: 0.875rem;">ÁÇπÂáªÂ±ïÂºÄ</span>
                        </h2>
                        <ul class="text-dark-green" style="list-style: none;">
                            <li class="hover-glow" style="padding: 0.5rem; transition: all 0.3s ease;">ÂñúÊ¨¢Ëá™È©æÊ∏∏</li>
                            <li class="hover-glow" style="padding: 0.5rem; transition: all 0.3s ease;">ÂñúÊ¨¢Áå´Áå´ÁãóÁãó</li>
                            <li class="hover-glow" style="padding: 0.5rem; transition: all 0.3s ease;">Â∞èÈ©¨ÂÆùËéâÂíåÁãêÂ¶ñÂ∞èÁ∫¢Â®ò</li>
                            <li class="hover-glow" style="padding: 0.5rem; transition: all 0.3s ease;">Âú∞Áã±Â∞ëÂ•≥ÂçÅÂπ¥Á≤â‰∏ù</li>
                        </ul>
                    </div>

                    <div id="socialCard" class="bg-lighter-yellow social-card">
                        <h2 class="text-dark-green" style="margin-bottom: 1rem;">ÊàëÁöÑÁ§æ‰∫§</h2>
                        <ul class="text-bright-pink" style="list-style: none;">
                            <li class="social-link cursor-pointer" onclick="window.open('https://www.douyin.com/user/self?from_tab_name=main&showTab=post', '_blank')">ÊäñÈü≥</li>
                            <li class="social-link cursor-pointer" onclick="window.open('https://www.xiaohongshu.com/user/profile/63fd4a2d0000000010025348', '_blank')">Â∞èÁ∫¢‰π¶</li>
                        </ul>
                    </div>
                </div>

                <div class="bg-lighter-yellow" style="margin-top: 2rem;">
                    <h2 class="text-dark-green floating">ÊàëÁöÑ‰ΩúÂìÅ</h2>
                    <div class="works-grid" id="workGrid">
                        <!-- ‰ΩúÂìÅ‰∏Ä -->
                        <div class="image-container hover-glow" data-work="1">
                            <img src="public/work1.jpg" alt="ÂÆûÁâ©ÈÉ®ÂàÜÂ±ïÁ§∫">
                            <div class="image-overlay">
                                <span>ÂÆûÁâ©ÈÉ®ÂàÜÂ±ïÁ§∫</span>
                            </div>
                        </div>
                        <!-- ‰ΩúÂìÅ‰∫å -->
                        <div class="image-container hover-glow" data-work="2">
                            <img src="public/work2.jpg" alt="ËØæÁ®ãÈÉ®ÂàÜ‰ΩúÂìÅ">
                            <div class="image-overlay">
                                <span>ËØæÁ®ãÈÉ®ÂàÜ‰ΩúÂìÅ</span>
                            </div>
                        </div>
                        <!-- ‰ΩúÂìÅ‰∏â -->
                        <div class="image-container hover-glow" data-work="3">
                            <img src="public/work3.jpg" alt="Èöè‰æøÁîªÁîª">
                            <div class="image-overlay">
                                <span>Èöè‰æøÁîªÁîª</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊúâË∂£ÁöÑ‰∫ãÈ°µÈù¢ -->
        <div id="fun" class="page">
            <div class="garden-background" id="funGarden"></div>
            <div class="container">
                <p class="game-intro" style="font-size: 1.2rem; color: var(--dark-green); margin-bottom: 1.5rem; text-align: center;">
                    ËøôÈáåÊòØÂñúÊ¨¢Áå´Áå´ÁãóÁãóÁöÑÊ∏∏Êàè‰πêÂõ≠ÔºåÂø´‰∏ãÊãâÈ°µÈù¢ËØïËØïÂêßÔºÅ
                </p>
                <div class="maze-container">
                    <h2 class="text-dark-green">Ëø∑ÂÆ´Ê∏∏Êàè</h2>
                    <p id="mazeInfo" class="text-dark-green">‰ΩøÁî®ÊñπÂêëÈîÆÊéßÂà∂Â∞èÁå´ÁßªÂä®ÔºÅ</p>
                    <div id="maze"></div>
                    <div class="maze-controls">
                        <button class="maze-container .adopt-button" onclick="generateMaze()">ÁîüÊàêÊñ∞Ëø∑ÂÆ´</button>
                    </div>
                </div>

                <div class="pet-garden">
                    <h2 class="text-dark-green">È¢ÜÂÖªÂ∞èÁå´</h2>
                    <p class="text-dark-green">ÈÄâÊã©‰∏ÄÂè™ÂèØÁà±ÁöÑÂ∞èÁå´‰Ωú‰∏∫‰Ω†ÁöÑ‰ºô‰º¥ÔºÅ</p>
                    <button class="adopt-button" onclick="handleAdoptionClick()">ÂºÄÂßãÈ¢ÜÂÖª</button>
                </div>

                <!-- ÈöèÊú∫Â∞èÁãóÂõæÁâáÁîüÊàêÂô® -->
                <div class="dog-generator-section" style="margin-top: 2rem; padding: 2rem; background-color: var(--light-pink); border-radius: 15px; text-align: center;">
                    <h2 class="text-dark-green" style="font-family: 'AaBaiYunCangGouYeMaChenAi', sans-serif;">ËØ¥ËØ¥‰Ω†ÂøÉÈáåÁöÑÂ∞èÁãó</h2>
                    <div class="dog-image-container" style="max-width: 500px; margin: 0 auto; position: relative;">
                        <img id="randomDogImage" src="" alt="ÈöèÊú∫Â∞èÁãóÂõæÁâá" style="width: 100%; border-radius: 10px; display: none;">
                        <div class="loading-spinner" style="display: none;">
                            <div style="width: 40px; height: 40px; border: 4px solid var(--bright-pink); border-top-color: transparent; border-radius: 50%; margin: 0 auto; animation: spin 1s linear infinite;"></div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button id="generateDogBtn" style="padding: 0.8rem 1.5rem; background-color: var(--bright-pink); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1.1rem; transition: all 0.3s ease;">
                            ÁîüÊàêÊñ∞ÁöÑÂ∞èÁãóÂõæÁâá
                        </button>
                        <button id="voiceControlBtn" style="margin-left: 1rem; padding: 0.8rem 1.5rem; background-color: var(--dark-green); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1.1rem; transition: all 0.3s ease;">
                            ËØ≠Èü≥ÊèèËø∞ÁîüÊàê
                        </button>
                    </div>
                    <div id="voiceStatus" style="margin-top: 1rem; color: var(--dark-green); font-size: 0.9rem;"></div>
                </div>
            </div>
        </div>

        <!-- ËÅîÁ≥ªÊàëÈ°µÈù¢ -->
        <div id="contact" class="page">
            <div class="garden-background" id="contactGarden"></div>
            <div class="container">
                <div class="message-garden">
                    <h2 class="text-dark-green">ÁïôË®ÄËä±Âõ≠</h2>
                    <p class="text-dark-green">Âú®ËøôÈáåÁïô‰∏ã‰Ω†ÁöÑÂøÉÊÉÖ‰∏éÊÉ≥Ê≥ïÔºåËÆ©ÁæéÂ•ΩÁöÑÊñáÂ≠óÂú®Ëä±Âõ≠‰∏≠ÁªΩÊîæ~</p>
                    
                    <div class="message-form">
                        <textarea class="message-input" placeholder="ÂÜô‰∏ã‰Ω†ÊÉ≥ËØ¥ÁöÑËØù..." maxlength="500"></textarea>
                        <button class="send-button" onclick="sendMessage()">
                            ÂèëÈÄÅÁïôË®Ä
                            <span>‚úâÔ∏è</span>
                        </button>
                    </div>

                    <div class="messages-container" id="messagesContainer">
                        <!-- Messages will be displayed here -->
                    </div>

                    <div class="personality-section" style="margin-top: 40px;">
                        <h3 class="text-dark-green" style="text-align: center; margin-bottom: 20px;">ÁªôÊàëË¥¥‰∏äÊ†áÁ≠æÂêß~</h3>
                        <div class="tag-cloud">
                            <div class="tag" style="background: #FF69B4;">
                                <span class="tag-text">ÁÉ≠Áà±ÁîüÊ¥ª</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #87CEEB;">
                                <span class="tag-text">ÂàõÊÑèÊó†Èôê</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #98FB98;">
                                <span class="tag-text">ÁßØÊûÅÂêë‰∏ä</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #DDA0DD;">
                                <span class="tag-text">Ê∏©ÊöñÊ≤ªÊÑà</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #F0E68C;">
                                <span class="tag-text">ÂÖÖÊª°Ê¥ªÂäõ</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #FFA07A;">
                                <span class="tag-text">‰πêËßÇÂºÄÊúó</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #B0C4DE;">
                                <span class="tag-text">ÂñÑËâØÂèãÂ•Ω</span>
                                <span class="like-count">0</span>
                            </div>
                            <div class="tag" style="background: #FFB6C1;">
                                <span class="tag-text">Âãá‰∫éÂ∞ùËØï</span>
                                <span class="like-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê∑ªÂä†ÈÇÆÁÆ±ÂõæÊ†áÂíåÊ∂àÊÅØÂàóË°® -->
        <div class="mailbox" onclick="toggleMessages()" style="position: fixed; bottom: 20px; right: 20px; background: var(--dark-green); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <span>üìÆ</span>
            <div class="mailbox-count" style="position: absolute; top: -5px; right: -5px; background: var(--bright-pink); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center;">0</div>
        </div>

        <div id="messages-modal" class="messages-modal" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 300px; max-height: 400px; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 15px; z-index: 1000;">
            <!-- Messages will be displayed here -->
        </div>

        <!-- È¢ÜÂÖªÊ®°ÊÄÅÊ°Ü -->
        <div id="adoptionOverlay" class="modal-overlay">
            <div id="adoptionModal" class="modal">
                <h2 class="text-dark-green">ÈÄâÊã©‰Ω†ÁöÑÂ∞è‰ºô‰º¥</h2>
                <div class="pet-cards-container">
                    <div class="pet-card">
                        <div class="pet-image" style="background-image: url('public/Â∞èÁÅ∞.png')"></div>
                        <h3 class="pet-name">ÁÅ∞ÁÅ∞</h3>
                        <p>‰∏ÄÂè™ÂÆâÈùôÁöÑÁÅ∞Ëâ≤Â∞èÁå´</p>
                        <button class="adopt-button" onclick="adoptPet('ÁÅ∞ÁÅ∞')">È¢ÜÂÖªÊàë</button>
                    </div>
                    <div class="pet-card">
                        <div class="pet-image" style="background-image: url('public/Èõ™ÁêÉ.png')"></div>
                        <h3 class="pet-name">Èõ™ÁêÉ</h3>
                        <p>Ê¥ªÊ≥ºÂèØÁà±ÁöÑÊ©òÁå´</p>
                        <button class="adopt-button" onclick="adoptPet('Èõ™ÁêÉ')">È¢ÜÂÖªÊàë</button>
                    </div>
                    <div class="pet-card">
                        <div class="pet-image" style="background-image: url('public/Â§ßËèä.png')"></div>
                        <h3 class="pet-name">Â§ßÊ©ò</h3>
                        <p>Ê∏©È°∫‰πñÂ∑ßÁöÑÊ©òÁå´</p>
                        <button class="adopt-button" onclick="adoptPet('Â§ßÊ©ò')">È¢ÜÂÖªÊàë</button>
                    </div>
                </div>
                <button class="adopt-button close-button" onclick="closeAdoptionModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>

        <!-- ÂÆ†Áâ©Áä∂ÊÄÅÈù¢Êùø -->
        <div class="pet-status" id="petStatus">
            <div class="adopted-pet" id="adoptedPetImage"></div>
            <div class="pet-mood" id="petMood">üòä</div>
            <h3 class="text-dark-green" id="petName"></h3>
            <div>
                <p class="text-dark-green">ÊÑâÊÇ¶ÂÄºÔºö<span id="happinessValue">100</span>%</p>
                <div class="status-bar">
                    <div class="status-bar-fill happiness-bar" id="happinessBar" style="width: 100%"></div>
                </div>
            </div>
            <div>
                <p class="text-dark-green">È••È•øÂ∫¶Ôºö<span id="hungerValue">100</span>%</p>
                <div class="status-bar">
                    <div class="status-bar-fill hunger-bar" id="hungerBar" style="width: 100%"></div>
                </div>
            </div>
            <div class="pet-actions">
                <button class="pet-action-btn" onclick="playWithPet()">Èô™Áé©</button>
                <button class="pet-action-btn" onclick="feedPet()">ÂñÇÈ£ü</button>
            </div>
        </div>

        <!-- ÂõæÁâáÂ±ïÁ§∫Ê®°ÊÄÅÊ°Ü -->
        <div id="imageModal" class="modal-overlay">
            <div class="image-modal">
                <span class="close-button" onclick="closeImageModal()">&times;</span>
                <div class="image-container">
                    <img id="modalImage" src="" alt="Â±ïÁ§∫ÂõæÁâá">
                </div>
                <div class="image-navigation">
                    <button onclick="prevImage()">‰∏ä‰∏ÄÂº†</button>
                    <button onclick="nextImage()">‰∏ã‰∏ÄÂº†</button>
                </div>
                <button class="like-button" onclick="handleLike()">
                    <span class="heart-icon">‚ù§Ô∏è</span>
                    <span class="like-count">0</span>
                </button>
            </div>
        </div>

        <!-- Âà†Èô§AIÂØπËØùÁ™óÂè£HTMLÁªìÊûÑ -->
        <div id="aiChat" style="display: none;"></div>

        <!-- Âà†Èô§ËÅäÂ§©È°µÈù¢ -->
        <div id="chat" style="display: none;"></div>

        <!-- AIÂØπËØùÊ†è -->
        <div class="ai-chat-bar">
            <div class="ai-chat-header">
                <h3>ÂíåÊùéËØóÊ∑ºËÅäÂ§©</h3>
                <button onclick="toggleAIChatBar()" class="toggle-button">‚ûñ</button>
            </div>
            <div class="ai-chat-content" id="aiChatContent">
                <div class="ai-messages" id="aiMessages">
                    <div class="ai-message">
                        <div class="ai-avatar">ÊùéËØóÊ∑º</div>
                        <div class="ai-text">‰Ω†Â•ΩÔºÅÊàëÊòØÊùéËØóÊ∑ºÔºåÊúâ‰ªÄ‰πàÊÉ≥ÂíåÊàëËÅäÁöÑÂêóÔºü</div>
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" id="aiInput" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." onkeypress="handleAIKeyPress(event)">
                    <button onclick="sendAIMessage()" class="ai-send-button">ÂèëÈÄÅ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ËøîÂõûÂ∞ÅÈù¢ÂáΩÊï∞
        function backToCover() {
            const coverPage = document.getElementById('coverPage');
            const mainContent = document.getElementById('mainContent');
            
            // ÊòæÁ§∫Â∞ÅÈù¢
            coverPage.style.display = 'flex';
            coverPage.style.opacity = '1';
            
            // ÈöêËóè‰∏ªÂÜÖÂÆπ
            mainContent.style.display = 'none';
            
            // ÈáçÊñ∞ÈöèÊú∫ÂàÜÂ∏ÉÂõæÁâá
            randomizePositions();
        }

        // È°µÈù¢ÂØºËà™ÂáΩÊï∞
        function navigateTo(page) {
            const coverPage = document.getElementById('coverPage');
            const mainContent = document.getElementById('mainContent');
            
            // Ê∑°Âá∫Â∞ÅÈù¢
            coverPage.style.opacity = '0';
            
            // ÊòæÁ§∫‰∏ªÂÜÖÂÆπÂπ∂Ë∑≥ËΩ¨Âà∞ÂØπÂ∫îÈ°µÈù¢
            setTimeout(() => {
                coverPage.style.display = 'none';
                mainContent.style.display = 'block';
                showPage(page);
            }, 1000);
        }

        // ÈöèÊú∫ÂàÜÂ∏ÉÂõæÁâá
        function randomizePositions() {
            const areas = ['camera-area', 'cat-area', 'notebook-area', 'palette-area'];
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // ÂÆö‰πâÂÆâÂÖ®Âå∫ÂüüÔºà‰∏≠Èó¥ÊñáÂ≠óÂå∫ÂüüÔºâ
            const safeZone = {
                x: (windowWidth - 400) / 2,
                y: (windowHeight - 200) / 2,
                width: 400,
                height: 200
            };
            
            // Â≠òÂÇ®Â∑≤ÊîæÁΩÆÂõæÁâáÁöÑ‰ΩçÁΩÆ
            const placedImages = [];
            
            areas.forEach(area => {
                const element = document.querySelector(`.${area}`);
                if (element) {
                    let randomX, randomY;
                    let attempts = 0;
                    const maxAttempts = 100;
                    let positionFound = false;
                    
                    do {
                        // ËÆ°ÁÆóÈöèÊú∫‰ΩçÁΩÆÔºåÁ°Æ‰øùÂõæÁâá‰∏ç‰ºöË∂ÖÂá∫Â±èÂπï
                        const maxX = windowWidth - 350;
                        const maxY = windowHeight - 350;
                        
                        randomX = Math.floor(Math.random() * maxX);
                        randomY = Math.floor(Math.random() * maxY);
                        
                        attempts++;
                        
                        // Ê£ÄÊü•ÊòØÂê¶‰∏éÂÆâÂÖ®Âå∫ÂüüÈáçÂè†
                        const overlapsSafeZone = 
                            randomX + 350 > safeZone.x && 
                            randomX < safeZone.x + safeZone.width &&
                            randomY + 350 > safeZone.y && 
                            randomY < safeZone.y + safeZone.height;
                        
                        // Ê£ÄÊü•ÊòØÂê¶‰∏éÂÖ∂‰ªñÂ∑≤ÊîæÁΩÆÁöÑÂõæÁâáÈáçÂè†
                        const overlapsOtherImages = placedImages.some(placed => {
                            return (
                                randomX + 350 > placed.x &&
                                randomX < placed.x + 350 &&
                                randomY + 350 > placed.y &&
                                randomY < placed.y + 350
                            );
                        });
                        
                        // Â¶ÇÊûú‰ΩçÁΩÆÂêàÈÄÇÔºåÊ†áËÆ∞‰∏∫ÊâæÂà∞‰ΩçÁΩÆ
                        if (!overlapsSafeZone && !overlapsOtherImages) {
                            positionFound = true;
                        }
                        
                        // Â¶ÇÊûúÂ∞ùËØïÊ¨°Êï∞ËøáÂ§öÔºåÂº∫Âà∂ÊîæÁΩÆÂú®ÊúÄËæπÁºò
                        if (attempts >= maxAttempts && !positionFound) {
                            // Â∞ùËØïÂõõ‰∏™ËßíËêΩ
                            const corners = [
                                { x: 0, y: 0 }, // Â∑¶‰∏ä
                                { x: maxX, y: 0 }, // Âè≥‰∏ä
                                { x: 0, y: maxY }, // Â∑¶‰∏ã
                                { x: maxX, y: maxY } // Âè≥‰∏ã
                            ];
                            
                            // Ê£ÄÊü•ÊØè‰∏™ËßíËêΩÊòØÂê¶ÂèØÁî®
                            for (const corner of corners) {
                                const cornerOverlaps = placedImages.some(placed => {
                                    return (
                                        corner.x + 350 > placed.x &&
                                        corner.x < placed.x + 350 &&
                                        corner.y + 350 > placed.y &&
                                        corner.y < placed.y + 350
                                    );
                                });
                                
                                if (!cornerOverlaps) {
                                    randomX = corner.x;
                                    randomY = corner.y;
                                    positionFound = true;
                                    break;
                                }
                            }
                            
                            // Â¶ÇÊûúÊâÄÊúâËßíËêΩÈÉΩË¢´Âç†Áî®ÔºåÂº∫Âà∂ÊîæÁΩÆÂú®ÊúÄËæπÁºò
                            if (!positionFound) {
                                randomX = Math.random() > 0.5 ? 0 : maxX;
                                randomY = Math.random() > 0.5 ? 0 : maxY;
                            }
                        }
                    } while (!positionFound && attempts < maxAttempts);
                    
                    // ËÆ∞ÂΩïÂ∑≤ÊîæÁΩÆÂõæÁâáÁöÑ‰ΩçÁΩÆ
                    placedImages.push({ x: randomX, y: randomY });
                    
                    element.style.left = `${randomX}px`;
                    element.style.top = `${randomY}px`;
                    element.style.right = 'auto';
                    element.style.bottom = 'auto';
                }
            });
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÈöèÊú∫ÂàÜÂ∏ÉÂõæÁâá
        window.addEventListener('load', randomizePositions);
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞ÈöèÊú∫ÂàÜÂ∏É
        window.addEventListener('resize', randomizePositions);

        // ÂÖ®Â±ÄÂèòÈáè
        let maze = [];
        let path = [];
        let catPosition = [1, 1];
        const mazeSize = 11;
        let isMoving = false;
        let moveTimeout = null;
        let adoptedPet = null;
        let petInterval = null;
        let showSocial = false;
        let activeWork = null;

        // Ê∑ªÂä†Ê†ë‰∏õÂä®ÁîªÁõ∏ÂÖ≥ÂèòÈáè
        let isBushHidden = false;
        let mouseX = 0;
        let mouseY = 0;
        let bushX = 0;
        let bushY = 0;

        // Ê∑ªÂä†ÁïôË®ÄËä±Âõ≠Áõ∏ÂÖ≥ÂèòÈáè
        let messages = JSON.parse(localStorage.getItem('gardenMessages') || '[]');

        // ÂàùÂßãÂåñÊ∂àÊÅØÊï∞ÁªÑ
        let mailboxMessages = JSON.parse(localStorage.getItem('mailboxMessages')) || [];

        // DOMÂä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            initializePersonalityCard();
            initializeWorks();
            initializeNavigation();
            generateMaze();
            
            // Ê∑ªÂä†ÈîÆÁõòÊéßÂà∂
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAdoptionModal();
                } else if (e.key.startsWith('Arrow')) {
                    switch(e.key) {
                        case 'ArrowUp': moveCat('up'); break;
                        case 'ArrowDown': moveCat('down'); break;
                        case 'ArrowLeft': moveCat('left'); break;
                        case 'ArrowRight': moveCat('right'); break;
                    }
                }
            });
            
            // ÊÅ¢Â§çÂÆ†Áâ©Áä∂ÊÄÅ
            try {
                const savedPet = localStorage.getItem('adoptedPet');
                if (savedPet) {
                    adoptedPet = JSON.parse(savedPet);
                    updatePetStatus();
                    startPetMonitoring();
                }
            } catch (error) {
                console.error('ÊÅ¢Â§çÂÆ†Áâ©Áä∂ÊÄÅÂ§±Ë¥•:', error);
            }

            // ÂàùÂßãÂåñÊ†ë‰∏õÂä®Áîª
            initializeBushAnimation();

            // Ê∑ªÂä†ÁïôË®ÄËä±Âõ≠Áõ∏ÂÖ≥ÂáΩÊï∞
            updateMailboxCount();
            createFlowers();

            // Ê∑ªÂä†ÁßòÂØÜËä±Âõ≠ËÉåÊôØÂä®Áîª
            initializeGardenBackground();

            // Ê∑ªÂä†ÊµÅÂä®Ê†ëÂè∂ËÉåÊôØÂàùÂßãÂåñ
            initializeFloatingLeaves();

            // Ê∑ªÂä†Âä®ÊÄÅÂ∞èÁå´Ë°å‰∏∫
            createActivePet();

            // ÂàùÂßãÂåñËØ≠Èü≥ËØÜÂà´
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'zh-CN';

                recognition.onresult = function(event) {
                    const result = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = result;
                };

                recognition.onend = function() {
                    isVoiceInputActive = false;
                    document.getElementById('voiceWave').classList.remove('active');
                };
            }

            // ‰øÆÊîπÂèëÈÄÅÊ∂àÊÅØÂáΩÊï∞
            async function sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    // ÊòæÁ§∫Áî®Êà∑Ê∂àÊÅØ
                    addMessage(message, true);
                    input.value = '';
                    
                    // ÊòæÁ§∫Ê≠£Âú®ËæìÂÖ•Áä∂ÊÄÅ
                    const typingDiv = document.createElement('div');
                    typingDiv.className = 'chat-message';
                    typingDiv.innerHTML = `
                        <div class="message-avatar ai">ÈªõÁéâ</div>
                        <div class="message-content typing">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                    `;
                    document.getElementById('chatMessages').appendChild(typingDiv);
                    
                    // Ë∞ÉÁî®Deepseek APIËé∑ÂèñÂõûÂ§ç
                    const response = await sendToDeepseek(message);
                    
                    // ÁßªÈô§ËæìÂÖ•Áä∂ÊÄÅÊòæÁ§∫
                    typingDiv.remove();
                    
                    // ÊòæÁ§∫AIÂõûÂ§ç
                    addMessage(response, false);
                }
            }

            // ‰øÆÊîπÂàùÂßãÊ¨¢ËøéËØ≠
            document.querySelector('#chatMessages .message-content').textContent = 
                'Â¶æË∫´ËßÅËøáÂêÑ‰Ωç„ÄÇ‰ªäÊó•Êò•ÂÖâÊ≠£Â•ΩÔºåËÉΩ‰∏éËØ∏‰ΩçÁõ∏Ë∞àÔºå‰πüÊòØ‰∏ÄÊÆµ‰Ω≥ÁºòÂë¢„ÄÇ‰∏çÁü•Êúâ‰ΩïËßÅÊïôÔºü';

            // ‰øÆÊîπAIÂ§¥ÂÉèÊòæÁ§∫
            document.querySelectorAll('.message-avatar.ai').forEach(avatar => {
                avatar.textContent = 'ÈªõÁéâ';
                avatar.style.fontFamily = '"Ê•∑‰Ωì", KaiTi, serif';
            });

            // Ê∑ªÂä†ËæìÂÖ•Ê°ÜÊèêÁ§∫ËØ≠
            document.querySelector('#chatInput').placeholder = 'Êúâ‰ΩïËØùË¶Å‰∏éÂ¶æË∫´ËØ¥Âë¢...';

            // ‰øÆÊîπÂèëÈÄÅÊåâÈíÆÊ†∑Âºè
            const sendButton = document.querySelector('.input-container button[title="ÂèëÈÄÅ"]');
            sendButton.innerHTML = 'Â•â‰∏ä';
            sendButton.style.fontFamily = '"Ê•∑‰Ωì", KaiTi, serif';

            // ÁªëÂÆöÈ¢ÜÂÖªÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            const startAdoptionButton = document.getElementById('startAdoption');
            if (startAdoptionButton) {
                startAdoptionButton.addEventListener('click', function() {
                    showAdoptionModal();
                });
            }
        });

        // È°µÈù¢ÂàáÊç¢ÂäüËÉΩ
        function showPage(pageId) {
            console.log('ÂàáÊç¢È°µÈù¢Âà∞:', pageId);
            // ÈöêËóèÊâÄÊúâÈ°µÈù¢
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÈ°µÈù¢
            const selectedPage = document.getElementById(pageId);
            if (selectedPage) {
                selectedPage.classList.add('active');
            }

            // Á°Æ‰øùÂè™Êúâ‰∏Ä‰∏™Â∞èÁå´
            const existingPets = document.querySelectorAll('#activePet');
            if (existingPets.length > 1) {
                // Â¶ÇÊûúÂ≠òÂú®Â§ö‰∏™Â∞èÁå´ÔºåÂè™‰øùÁïôÁ¨¨‰∏Ä‰∏™ÔºåÁßªÈô§ÂÖ∂‰ªñÁöÑ
                for (let i = 1; i < existingPets.length; i++) {
                    existingPets[i].remove();
                }
            }

            // Á°Æ‰øùÂ∞èÁå´Âú®È°µÈù¢ÂàáÊç¢Âêé‰ªçÁÑ∂Â≠òÂú®
            const pet = document.getElementById('activePet');
            if (!pet && adoptedPet) {
                createActivePet();
            } else if (pet) {
                // Â¶ÇÊûúÂ∞èÁå´Â≠òÂú®ÔºåÂ∞ÜÂÖ∂ÁßªÂä®Âà∞Êñ∞È°µÈù¢ÁöÑÂêàÈÄÇ‰ΩçÁΩÆ
                const container = selectedPage.querySelector('.container');
                if (container) {
                    const rect = container.getBoundingClientRect();
                    const newX = rect.left + (rect.width / 2);
                    const newY = rect.top + (rect.height / 2);
                    pet.style.left = newX + 'px';
                    pet.style.top = newY + 'px';
                }
            }
        }

        // ÂàùÂßãÂåñ‰∏™ÊÄßÂç°Áâá
        function initializePersonalityCard() {
            const personalityCard = document.getElementById('personalityCard');
            const socialCard = document.getElementById('socialCard');
            const toggleText = document.getElementById('toggleText');

            personalityCard.addEventListener('click', () => {
                showSocial = !showSocial;
                toggleText.textContent = showSocial ? "ÁÇπÂáªÊî∂Ëµ∑" : "ÁÇπÂáªÂ±ïÂºÄ";
                socialCard.classList.toggle('active', showSocial);
            });

            const items = personalityCard.querySelectorAll('li');
            items.forEach(item => {
                item.addEventListener('mouseenter', () => {
                    item.style.transform = 'translateX(10px)';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.transform = 'translateX(0)';
                });
            });
        }

        // ÂàùÂßãÂåñ‰ΩúÂìÅÂ±ïÁ§∫
        function initializeWorks() {
            const workGrid = document.getElementById('workGrid');
            const works = [
                { id: 1, title: '‰ΩúÂìÅ‰∏Ä', image: './public/work1.jpg' },
                { id: 2, title: '‰ΩúÂìÅ‰∫å', image: './public/work2.jpg' },
                { id: 3, title: '‰ΩúÂìÅ‰∏â', image: './public/work3.jpg' }
            ];

            works.forEach(work => {
                const workCard = createWorkCard(work);
                workGrid.appendChild(workCard);
            });
        }

        // ÂàõÂª∫‰ΩúÂìÅÂç°Áâá
        function createWorkCard(work) {
            const div = document.createElement('div');
            div.className = 'image-container hover-glow';
            div.innerHTML = `
                <img src="${work.image}" alt="${work.title}">
                <div class="image-overlay">
                    <span>${work.title}</span>
                </div>
            `;

            div.addEventListener('click', () => handleWorkClick(work.id, div));
            return div;
        }

        // Â§ÑÁêÜ‰ΩúÂìÅÁÇπÂáª
        function handleWorkClick(id, element) {
            if (activeWork === id) {
                element.classList.remove('active');
                activeWork = null;
            } else {
                document.querySelectorAll('.image-container').forEach(container => {
                    container.classList.remove('active');
                });
                element.classList.add('active');
                activeWork = id;
            }
        }

        // ÂàùÂßãÂåñÂØºËà™
        function initializeNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    navItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                });
            });
        }

        // Ëø∑ÂÆ´Áõ∏ÂÖ≥ÂáΩÊï∞
        function generateMaze() {
            console.log('ÂºÄÂßãÁîüÊàêËø∑ÂÆ´...');
            maze = [];
            path = [];
            
            // ÂàùÂßãÂåñËø∑ÂÆ´
            for (let i = 0; i < mazeSize; i++) {
                maze[i] = [];
                for (let j = 0; j < mazeSize; j++) {
                    maze[i][j] = 1;
                }
            }

            function carve(x, y) {
                maze[x][y] = 0;
                const directions = [[0, 2], [2, 0], [0, -2], [-2, 0]];
                
                for (let i = directions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [directions[i], directions[j]] = [directions[j], directions[i]];
                }
                
                for (let [dx, dy] of directions) {
                    const newX = x + dx;
                    const newY = y + dy;
                    if (newX > 0 && newX < mazeSize - 1 && newY > 0 && newY < mazeSize - 1 && maze[newX][newY] === 1) {
                        maze[x + dx/2][y + dy/2] = 0;
                        carve(newX, newY);
                    }
                }
            }

            carve(1, 1);
            maze[1][1] = 2;
            maze[mazeSize-2][mazeSize-2] = 3;
            catPosition = [1, 1];
            displayMaze();
        }

        function displayMaze() {
            const mazeElement = document.getElementById('maze');
            mazeElement.style.gridTemplateColumns = `repeat(${mazeSize}, 1fr)`;
            mazeElement.innerHTML = '';
            
            for (let i = 0; i < mazeSize; i++) {
                for (let j = 0; j < mazeSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'maze-cell';
                    
                    if (maze[i][j] === 1) {
                        cell.classList.add('wall');
                    } else if (maze[i][j] === 2) {
                        cell.classList.add('start');
                    } else if (maze[i][j] === 3) {
                        cell.classList.add('end');
                    }
                    
                    if (i === catPosition[0] && j === catPosition[1]) {
                        cell.classList.add('cat');
                    }
                    
                    mazeElement.appendChild(cell);
                }
            }
        }

        function moveCat(direction) {
            if (isMoving) return;
            
            const [x, y] = catPosition;
            let newX = x;
            let newY = y;
            
            switch(direction) {
                case 'up': newX--; break;
                case 'down': newX++; break;
                case 'left': newY--; break;
                case 'right': newY++; break;
            }
            
            if (newX >= 0 && newX < mazeSize && newY >= 0 && newY < mazeSize && maze[newX][newY] !== 1) {
                isMoving = true;
                catPosition = [newX, newY];
                displayMaze();
                
                if (maze[newX][newY] === 3) {
                    showMazeCelebration();
                }
                
                setTimeout(() => {
                    isMoving = false;
                }, 300);
            }
        }

        function showMazeCelebration() {
            // ÂàõÂª∫Â∫ÜÁ•ùÂÆπÂô®
            const celebrationContainer = document.createElement('div');
            celebrationContainer.className = 'maze-celebration-container';
            document.body.appendChild(celebrationContainer);

            // Ê∑ªÂä†ËÉåÊôØÈÅÆÁΩ©
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';
            celebrationContainer.appendChild(overlay);

            // Ê∑ªÂä†ÁÉüËä±ÊïàÊûú
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createMazeFirework();
                }, i * 150);
            }

            // Ê∑ªÂä†ÂΩ©Â∏¶ÊïàÊûú
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    createMazeConfetti();
                }, i * 50);
            }

            // Ê∑ªÂä†ÊòüÊòüÊïàÊûú
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createStar();
                }, i * 200);
            }

            // Ê∑ªÂä†ÈÄöÂÖ≥ÊñáÂ≠ó
            const congratsText = document.createElement('div');
            congratsText.className = 'maze-congrats-text';
            congratsText.innerHTML = `
                <div class="maze-congrats-title">ÊÅ≠ÂñúÈÄöÂÖ≥ÔºÅüéâ</div>
                <div class="maze-congrats-subtitle">‰Ω†ÊàêÂäüËµ∞Âá∫‰∫ÜËø∑ÂÆ´ÔºÅ</div>
            `;
            celebrationContainer.appendChild(congratsText);

            // Êí≠ÊîæÂ∫ÜÁ•ùÈü≥Êïà
            const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU' + 
                '...'); // ËøôÈáåÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™ÁÆÄÁü≠ÁöÑÂ∫ÜÁ•ùÈü≥ÊïàÁöÑ base64 ÁºñÁ†Å
            audio.play().catch(() => {});

            // 5ÁßíÂêéÁßªÈô§Â∫ÜÁ•ùÊïàÊûú
            setTimeout(() => {
                celebrationContainer.remove();
            }, 5000);
        }

        function createMazeFirework() {
            const firework = document.createElement('div');
            firework.className = 'maze-firework';
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            
            // ÈöèÊú∫È¢úËâ≤
            const colors = ['#FFD700', '#FF4500', '#00FF00', '#4169E1', '#FF69B4'];
            firework.style.background = `radial-gradient(circle, ${colors[Math.floor(Math.random() * colors.length)]}, transparent)`;
            
            document.body.appendChild(firework);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                firework.remove();
            }, 1500);
        }

        function createMazeConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'maze-confetti';
            
            // ÈöèÊú∫ÂΩ¢Áä∂ÂíåÁ±ªÂûã
            const types = ['circle', 'square', 'triangle', 'spiral', 'glitter', 'ribbon'];
            const type = types[Math.floor(Math.random() * types.length)];
            confetti.classList.add(type);
            
            // ÈöèÊú∫È¢úËâ≤
            const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#FFD700', '#FF69B4', '#4169E1'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.backgroundColor = color;
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 15 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            
            // ÈöèÊú∫‰ΩçÁΩÆÂíåÊóãËΩ¨
            const x = Math.random() * window.innerWidth;
            const rotation = Math.random() * 360;
            const delay = Math.random() * 2;
            
            confetti.style.left = x + 'px';
            confetti.style.transform = `rotate(${rotation}deg)`;
            confetti.style.animationDelay = `${delay}s`;
            
            document.body.appendChild(confetti);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }

        function createStar() {
            const star = document.createElement('div');
            star.className = 'maze-star';
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            
            star.style.left = x + 'px';
            star.style.top = y + 'px';
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 20 + 10;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            
            document.body.appendChild(star);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                star.remove();
            }, 2000);
        }

        // ÂÆ†Áâ©È¢ÜÂÖªÁõ∏ÂÖ≥ÂáΩÊï∞
        function showAdoptionModal() {
            console.log('ÊòæÁ§∫È¢ÜÂÖªÂºπÁ™ó');
            const overlay = document.getElementById('adoptionOverlay');
            const modal = document.getElementById('adoptionModal');
            
            if (!overlay || !modal) {
                console.error('Êâæ‰∏çÂà∞È¢ÜÂÖªÂºπÁ™óÂÖÉÁ¥†');
                return;
            }
            
            overlay.style.display = 'block';
            modal.style.display = 'block';
            
            // Ê∑ªÂä†ÊòæÁ§∫Âä®Áîª
            requestAnimationFrame(() => {
                overlay.classList.add('show');
                modal.classList.add('show');
            });
        }

        function closeAdoptionModal() {
            const overlay = document.getElementById('adoptionOverlay');
            const modal = document.getElementById('adoptionModal');
            
            if (!overlay || !modal) {
                console.error('Êâæ‰∏çÂà∞È¢ÜÂÖªÂºπÁ™óÂÖÉÁ¥†');
                return;
            }
            
            overlay.classList.remove('show');
            modal.classList.remove('show');
            
            setTimeout(() => {
                overlay.style.display = 'none';
                modal.style.display = 'none';
            }, 300);
        }

        function adoptPet(petName) {
            if (!petName) {
                console.error('ÂÆ†Áâ©ÂêçÁß∞Êó†Êïà');
                return;
            }

            console.log('ÂºÄÂßãÈ¢ÜÂÖªÂÆ†Áâ©:', petName);
            
            // ÂàõÂª∫Â∫ÜÁ•ùÂä®Áîª
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
            
            // ÂàùÂßãÂåñÂÆ†Áâ©Áä∂ÊÄÅ
            adoptedPet = {
                name: petName,
                happiness: 100,
                hunger: 100,
                adoptionDate: new Date().toLocaleString()
            };
            
            // Êõ¥Êñ∞ÂÆ†Áâ©Áä∂ÊÄÅÊòæÁ§∫
            updatePetStatus();
            
            // ÂºÄÂßãÂÆ†Áâ©Áä∂ÊÄÅÁõëÊéß
            startPetMonitoring();
            
            // ‰øùÂ≠òÂÆ†Áâ©Áä∂ÊÄÅÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('adoptedPet', JSON.stringify(adoptedPet));
            
            // ÂàõÂª∫Âä®ÊÄÅÂ∞èÁå´
            createActivePet();
            
            // ÂÖ≥Èó≠È¢ÜÂÖªÂºπÁ™ó
            closeAdoptionModal();
            
            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            alert(`ÊÅ≠Âñú‰Ω†ÊàêÂäüÈ¢ÜÂÖª‰∫Ü${petName}ÔºÅ\nÁé∞Âú®ÂèØ‰ª•ÂíåÂÆÉ‰∫íÂä®‰∫ÜÔºÅ`);
        }

        // ÂàõÂª∫Âä®ÊÄÅÂ∞èÁå´
        function createActivePet() {
            console.log('ÂàõÂª∫Âä®ÊÄÅÂ∞èÁå´');
            // Â¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®Â∞èÁå´ÔºåÂÖàÁßªÈô§
            const existingPets = document.querySelectorAll('#activePet');
            existingPets.forEach(pet => pet.remove());

            const activePet = document.createElement('div');
            activePet.id = 'activePet';
            activePet.className = 'active-pet';
            
            // Ê†πÊçÆÈ¢ÜÂÖªÁöÑÂ∞èÁå´ËÆæÁΩÆÂØπÂ∫îÁöÑÂõæÁâá
            if (adoptedPet) {
                switch(adoptedPet.name) {
                    case 'ÁÅ∞ÁÅ∞':
                        activePet.style.backgroundImage = "url('public/Â∞èÁÅ∞.png')";
                        break;
                    case 'Èõ™ÁêÉ':
                        activePet.style.backgroundImage = "url('public/Èõ™ÁêÉ.png')";
                        break;
                    case 'Â§ßÊ©ò':
                        activePet.style.backgroundImage = "url('public/Â§ßËèä.png')";
                        break;
                }
            }
            
            // ËÆæÁΩÆÂàùÂßã‰ΩçÁΩÆ
            const maxX = window.innerWidth - 100;
            const maxY = window.innerHeight - 100;
            activePet.style.left = (Math.random() * maxX) + 'px';
            activePet.style.top = (Math.random() * maxY) + 'px';
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            activePet.addEventListener('click', function() {
                showPetInteractionOptions();
            });
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(activePet);
            
            // ÂºÄÂßãË∑üÈöèÈº†Ê†áÁßªÂä®
            startMouseFollowing(activePet);
        }

        // ÂºÄÂßãË∑üÈöèÈº†Ê†áÁßªÂä®
        function startMouseFollowing(pet) {
            console.log('ÂºÄÂßãË∑üÈöèÈº†Ê†áÁßªÂä®');
            let targetX = 0;
            let targetY = 0;
            let currentX = parseInt(pet.style.left);
            let currentY = parseInt(pet.style.top);
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÁßªÂä®Èó¥Èöî
            if (pet.dataset.moveInterval) {
                clearInterval(parseInt(pet.dataset.moveInterval));
            }
            
            // Â≠òÂÇ®Èº†Ê†á‰ΩçÁΩÆ
            document.addEventListener('mousemove', function(e) {
                targetX = e.clientX;
                targetY = e.clientY;
            });
            
            // ÊØè100ÊØ´ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°‰ΩçÁΩÆ
            const moveInterval = setInterval(() => {
                // ËÆ°ÁÆóÂΩìÂâç‰ΩçÁΩÆÂà∞ÁõÆÊ†á‰ΩçÁΩÆÁöÑË∑ùÁ¶ª
                const dx = targetX - currentX;
                const dy = targetY - currentY;
                
                // Â¶ÇÊûúË∑ùÁ¶ªË∂≥Â§üÂ§ßÔºåÂºÄÂßãÁßªÂä®
                if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {
                    // Ê†πÊçÆÁßªÂä®ÊñπÂêëÁøªËΩ¨Â∞èÁå´
                    if (dx < 0) {
                        pet.style.transform = 'scaleX(-1)';
                    } else {
                        pet.style.transform = 'scaleX(1)';
                    }
                    
                    // Âπ≥ÊªëÁßªÂä®
                    currentX += dx * 0.1;
                    currentY += dy * 0.1;
                    
                    // Á°Æ‰øùÂ∞èÁå´Âú®ÂèØËßÜÂå∫ÂüüÂÜÖ
                    const maxX = window.innerWidth - 100;
                    const maxY = window.innerHeight - 100;
                    
                    currentX = Math.max(0, Math.min(currentX, maxX));
                    currentY = Math.max(0, Math.min(currentY, maxY));
                    
                    pet.style.left = currentX + 'px';
                    pet.style.top = currentY + 'px';
                }
            }, 100);
            
            // Â≠òÂÇ®interval IDÔºå‰ª•‰æøÂú®ÈúÄË¶ÅÊó∂Ê∏ÖÈô§
            pet.dataset.moveInterval = moveInterval;
        }

        // ‰øÆÊîπÈ°µÈù¢ÂàáÊç¢ÂáΩÊï∞
        function showPage(pageId) {
            console.log('ÂàáÊç¢È°µÈù¢Âà∞:', pageId);
            // ÈöêËóèÊâÄÊúâÈ°µÈù¢
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÈ°µÈù¢
            const selectedPage = document.getElementById(pageId);
            if (selectedPage) {
                selectedPage.classList.add('active');
            }

            // Á°Æ‰øùÂè™Êúâ‰∏Ä‰∏™Â∞èÁå´
            const existingPets = document.querySelectorAll('#activePet');
            if (existingPets.length > 1) {
                // Â¶ÇÊûúÂ≠òÂú®Â§ö‰∏™Â∞èÁå´ÔºåÂè™‰øùÁïôÁ¨¨‰∏Ä‰∏™ÔºåÁßªÈô§ÂÖ∂‰ªñÁöÑ
                for (let i = 1; i < existingPets.length; i++) {
                    existingPets[i].remove();
                }
            }

            // Á°Æ‰øùÂ∞èÁå´Âú®È°µÈù¢ÂàáÊç¢Âêé‰ªçÁÑ∂Â≠òÂú®
            const pet = document.getElementById('activePet');
            if (!pet && adoptedPet) {
                createActivePet();
            } else if (pet) {
                // Â¶ÇÊûúÂ∞èÁå´Â≠òÂú®ÔºåÂ∞ÜÂÖ∂ÁßªÂä®Âà∞Êñ∞È°µÈù¢ÁöÑÂêàÈÄÇ‰ΩçÁΩÆ
                const container = selectedPage.querySelector('.container');
                if (container) {
                    const rect = container.getBoundingClientRect();
                    const newX = rect.left + (rect.width / 2);
                    const newY = rect.top + (rect.height / 2);
                    pet.style.left = newX + 'px';
                    pet.style.top = newY + 'px';
                }
            }
        }

        // Âú®È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Â¶ÇÊûúÂ∑≤ÁªèÈ¢ÜÂÖª‰∫ÜÂ∞èÁå´ÔºåÈáçÊñ∞ÂàõÂª∫ÂÆÉ
            try {
                const savedPet = localStorage.getItem('adoptedPet');
                if (savedPet) {
                    adoptedPet = JSON.parse(savedPet);
                    createActivePet();
                }
            } catch (error) {
                console.error('ÊÅ¢Â§çÂÆ†Áâ©Áä∂ÊÄÅÂ§±Ë¥•:', error);
            }
            
            // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ
            window.addEventListener('resize', function() {
                const pet = document.getElementById('activePet');
                if (pet) {
                    // Á°Æ‰øùÂ∞èÁå´Âú®ÂèØËßÜÂå∫ÂüüÂÜÖ
                    const maxX = window.innerWidth - 100;
                    const maxY = window.innerHeight - 100;
                    const currentX = parseInt(pet.style.left);
                    const currentY = parseInt(pet.style.top);
                    
                    if (currentX > maxX) pet.style.left = maxX + 'px';
                    if (currentY > maxY) pet.style.top = maxY + 'px';
                }
            });
            
            // ÁõëÂê¨ÂØºËà™ÁÇπÂáª‰∫ã‰ª∂
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault(); // ÈòªÊ≠¢ÈªòËÆ§Ë°å‰∏∫
                    const pageId = this.getAttribute('data-target');
                    if (pageId) {
                        showPage(pageId);
                    }
                });
            });
        });

        // ÊòæÁ§∫Â∞èÁå´‰∫íÂä®ÈÄâÈ°π
        function showPetInteractionOptions() {
            console.log('ÊòæÁ§∫‰∫íÂä®ÈÄâÈ°π');
            const options = document.createElement('div');
            options.className = 'pet-interaction-options';
            options.innerHTML = `
                <div class="interaction-option" onclick="playWithPet()">Èô™Áé©</div>
                <div class="interaction-option" onclick="feedPet()">ÂñÇÈ£ü</div>
                <div class="interaction-option" onclick="cancelAdoption()">ÂèñÊ∂àÈ¢ÜÂÖª</div>
            `;
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(options);
            
            // 3ÁßíÂêéËá™Âä®ÈöêËóè
            setTimeout(() => {
                options.remove();
            }, 3000);
        }

        // Èô™Áé©ÂäüËÉΩ
        function playWithPet() {
            const pet = document.getElementById('activePet');
            if (pet) {
                pet.classList.add('playing');
                setTimeout(() => {
                    pet.classList.remove('playing');
                }, 2000);
            }
        }

        // ÂñÇÈ£üÂäüËÉΩ
        function feedPet() {
            const pet = document.getElementById('activePet');
            if (pet) {
                pet.classList.add('eating');
                setTimeout(() => {
                    pet.classList.remove('eating');
                }, 2000);
            }
        }

        // ÂèñÊ∂àÈ¢ÜÂÖªÂäüËÉΩ
        function cancelAdoption() {
            // ÁßªÈô§Â∞èÁå´
            const pet = document.getElementById('activePet');
            if (pet) {
                pet.remove();
            }
            
            // Ê∏ÖÈô§È¢ÜÂÖªÁä∂ÊÄÅ
            adoptedPet = null;
            localStorage.removeItem('adoptedPet');
            
            // ÊòæÁ§∫ÊèêÁ§∫
            alert('Â∑≤ÂèñÊ∂àÈ¢ÜÂÖª');
        }

        function updatePetStatus() {
            if (!adoptedPet) return;
            
            const petStatus = document.getElementById('petStatus');
            const petNameElem = document.getElementById('petName');
            const happinessBar = document.getElementById('happinessBar');
            const hungerBar = document.getElementById('hungerBar');
            const happinessValue = document.getElementById('happinessValue');
            const hungerValue = document.getElementById('hungerValue');
            const petMood = document.getElementById('petMood');
            const adoptedPetImage = document.getElementById('adoptedPetImage');
            
            petStatus.classList.add('show');
            adoptedPetImage.style.backgroundImage = getPetImage(adoptedPet.name);
            petNameElem.textContent = adoptedPet.name;
            
            happinessBar.style.width = `${adoptedPet.happiness}%`;
            hungerBar.style.width = `${adoptedPet.hunger}%`;
            
            happinessValue.textContent = Math.round(adoptedPet.happiness);
            hungerValue.textContent = Math.round(adoptedPet.hunger);
            
            updatePetMood();
        }

        function getPetImage(petName) {
            const images = {
                'ÁÅ∞ÁÅ∞': 'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="%23808080"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="%23808080"/><path d="M6,3 h4 v1 h-4 z" fill="%23808080"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="%23808080"/><circle cx="6" cy="8" r="1" fill="white"/><circle cx="10" cy="8" r="1" fill="white"/><path d="M7,10 h2 v1 h-2 z" fill="white"/></svg>\')',
                'Ê©òÂ≠ê': 'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="%23FFA500"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="%23FFA500"/><path d="M6,3 h4 v1 h-4 z" fill="%23FFA500"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="%23FFA500"/><circle cx="6" cy="8" r="1" fill="white"/><circle cx="10" cy="8" r="1" fill="white"/><path d="M7,10 h2 v1 h-2 z" fill="white"/></svg>\')',
                'Èõ™ÁêÉ': 'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3,6 h10 v5 h-2 v2 h-6 v-2 h-2 z" fill="white"/><path d="M4,4 h2 v2 h-2 z M10,4 h2 v2 h-2 z" fill="white"/><path d="M6,3 h4 v1 h-4 z" fill="white"/><path d="M3,8 h2 v1 h-2 z M11,8 h2 v1 h-2 z" fill="white"/><circle cx="6" cy="8" r="1" fill="%23666"/><circle cx="10" cy="8" r="1" fill="%23666"/><path d="M7,10 h2 v1 h-2 z" fill="%23666"/></svg>\')'
            };
            return images[petName] || images['ÁÅ∞ÁÅ∞'];
        }

        function startPetMonitoring() {
            if (petInterval) clearInterval(petInterval);
            
            petInterval = setInterval(() => {
                if (!adoptedPet) return;
                
                adoptedPet.happiness = Math.max(0, adoptedPet.happiness - 0.5);
                adoptedPet.hunger = Math.max(0, adoptedPet.hunger - 0.3);
                
                updatePetStatus();
                localStorage.setItem('adoptedPet', JSON.stringify(adoptedPet));
            }, 10000);
        }

        function updatePetMood() {
            if (!adoptedPet) return;
            
            const petMood = document.getElementById('petMood');
            const averageStatus = (adoptedPet.happiness + adoptedPet.hunger) / 2;
            
            if (averageStatus > 80) {
                petMood.textContent = 'üòä';
            } else if (averageStatus > 60) {
                petMood.textContent = 'üòå';
            } else if (averageStatus > 40) {
                petMood.textContent = 'üòê';
            } else if (averageStatus > 20) {
                petMood.textContent = 'üòü';
            } else {
                petMood.textContent = 'üò¢';
            }
        }

        function playWithPet() {
            if (!adoptedPet) return;
            
            adoptedPet.happiness = Math.min(100, adoptedPet.happiness + 20);
            adoptedPet.hunger = Math.max(0, adoptedPet.hunger - 10);
            
            const adoptedPetImage = document.getElementById('adoptedPetImage');
            adoptedPetImage.style.transform = 'scale(1.2)';
            setTimeout(() => {
                adoptedPetImage.style.transform = 'scale(1)';
            }, 200);
            
            updatePetStatus();
            createFloatingEmoji('‚ù§Ô∏è');
        }

        function feedPet() {
            if (!adoptedPet) return;
            
            adoptedPet.hunger = Math.min(100, adoptedPet.hunger + 30);
            adoptedPet.happiness = Math.min(100, adoptedPet.happiness + 10);
            
            const adoptedPetImage = document.getElementById('adoptedPetImage');
            adoptedPetImage.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                adoptedPetImage.style.transform = 'translateY(0)';
            }, 200);
            
            updatePetStatus();
            createFloatingEmoji('üçñ');
        }

        function createFloatingEmoji(emoji) {
            const element = document.createElement('div');
            element.style.position = 'fixed';
            element.style.left = '50%';
            element.style.top = '50%';
            element.style.fontSize = '24px';
            element.style.pointerEvents = 'none';
            element.style.animation = 'float 1s ease-out forwards';
            element.textContent = emoji;
            document.body.appendChild(element);
            
            setTimeout(() => element.remove(), 1000);
        }

        // Ê†ë‰∏õÂä®ÁîªÁõ∏ÂÖ≥ÂáΩÊï∞
        function initializeBushAnimation() {
            const bushContainer = document.querySelector('.bush-container');
            if (!bushContainer) {
                console.error('Êú™ÊâæÂà∞ÁÅåÊú®ÂÆπÂô®');
                return;
            }
            createRandomLeaves(bushContainer);
        }

        // ÂàõÂª∫ÈöèÊú∫Ê†ëÂè∂
        function createRandomLeaves(container) {
            if (!container) {
                console.error('ÂÆπÂô®ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }

            const leafCount = 20;
            for (let i = 0; i < leafCount; i++) {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDelay = Math.random() * 5 + 's';
                leaf.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(leaf);
            }
        }

        // Ê∑ªÂä†ÁïôË®ÄËä±Âõ≠Áõ∏ÂÖ≥ÂáΩÊï∞
        function sendMessage() {
            const input = document.querySelector('.message-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ‰ΩøÁî®addMessageÂáΩÊï∞Ê∑ªÂä†Ê∂àÊÅØ
            addMessage(message);
            
            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            input.value = '';
            
            // ÂàõÂª∫ÂèëÈÄÅÂä®Áîª
            const envelope = document.createElement('div');
            envelope.textContent = '‚úâÔ∏è';
            envelope.style.position = 'fixed';
            envelope.style.fontSize = '24px';
            envelope.style.zIndex = '1000';
            envelope.style.transition = 'all 1s ease';
            
            const form = document.querySelector('.message-form');
            const formRect = form.getBoundingClientRect();
            const mailbox = document.querySelector('.mailbox');
            const mailboxRect = mailbox.getBoundingClientRect();
            
            envelope.style.left = `${formRect.right - 50}px`;
            envelope.style.top = `${formRect.top + 50}px`;
            document.body.appendChild(envelope);
            
            requestAnimationFrame(() => {
                envelope.style.left = `${mailboxRect.left + 15}px`;
                envelope.style.top = `${mailboxRect.top + 15}px`;
                envelope.style.transform = 'scale(0.5)';
            });
            
            setTimeout(() => {
                envelope.remove();
                showSuccessMessage();
            }, 1000);
        }

        function showSuccessMessage() {
            const success = document.createElement('div');
            success.textContent = 'ÁïôË®ÄÊàêÂäüÔºÅ';
            success.style.position = 'fixed';
            success.style.left = '50%';
            success.style.top = '50%';
            success.style.transform = 'translate(-50%, -50%)';
            success.style.background = 'rgba(76, 175, 80, 0.9)';
            success.style.color = 'white';
            success.style.padding = '1rem 2rem';
            success.style.borderRadius = '2rem';
            success.style.animation = 'fadeInOut 2s ease forwards';
            
            document.body.appendChild(success);
            setTimeout(() => success.remove(), 2000);
        }

        // Ê∑ªÂä†Ê∂àÊÅØÁöÑÂáΩÊï∞
        function addMessage(content) {
            if (!content.trim()) return; // Â¶ÇÊûúÊ∂àÊÅØ‰∏∫Á©∫Ôºå‰∏çÊ∑ªÂä†
            
            const newMessage = {
                content: content,
                time: new Date().toLocaleString()
            };
            mailboxMessages.push(newMessage);
            localStorage.setItem('mailboxMessages', JSON.stringify(mailboxMessages));
            displayMessages();
            updateMailboxCount();
        }

        // ÊòæÁ§∫Ê∂àÊÅØÁöÑÂáΩÊï∞
        function displayMessages() {
            const modal = document.getElementById('messages-modal');
            if (!modal) return;
            
            let messagesHtml = '';
            mailboxMessages.forEach((msg, index) => {
                messagesHtml += `
                    <div class="message-item" style="margin-bottom: 15px; padding: 10px; background-color: rgba(255, 255, 255, 0.9); border-radius: 8px; border: 1px solid #eee;">
                        <div class="message-content" style="color: var(--dark-green); margin-bottom: 8px; word-wrap: break-word; white-space: pre-wrap; font-size: 14px; display: block;">${msg.content}</div>
                        <div class="message-time" style="color: #666; font-size: 12px;">${msg.time}</div>
                    </div>
                `;
            });
            
            modal.innerHTML = messagesHtml;
        }

        // ÂàáÊç¢Ê∂àÊÅØÊòæÁ§∫
        function toggleMessages() {
            const modal = document.getElementById('messages-modal');
            if (modal.style.display === 'none' || !modal.style.display) {
                displayMessages();
                modal.style.display = 'block';
            } else {
                modal.style.display = 'none';
            }
        }

        // Êõ¥Êñ∞ÈÇÆÁÆ±Êï∞Â≠ó
        function updateMailboxCount() {
            const countElement = document.querySelector('.mailbox-count');
            if (countElement) {
                countElement.textContent = mailboxMessages.length;
            }
        }

        // ÂàùÂßãÂåñÊó∂Êõ¥Êñ∞ÈÇÆÁÆ±Êï∞Â≠ó
        document.addEventListener('DOMContentLoaded', () => {
            updateMailboxCount();
        });

        function createFlowers() {
            const mailbox = document.querySelector('.mailbox');
            const colors = ['#FF69B4', '#FFB6C1', '#FFC0CB', '#DB7093'];
            const numFlowers = 5;
            
            for (let i = 0; i < numFlowers; i++) {
                const flower = document.createElement('div');
                flower.className = 'flower';
                flower.innerHTML = 'üå∏';
                flower.style.position = 'absolute';
                
                const angle = (i / numFlowers) * Math.PI * 2;
                const radius = 40;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                
                flower.style.left = `${x + 30}px`;
                flower.style.top = `${y + 30}px`;
                flower.style.animationDelay = `${i * 0.2}s`;
                
                mailbox.appendChild(flower);
            }
        }

        // Ê∑ªÂä†ÁßòÂØÜËä±Âõ≠ËÉåÊôØÂä®Áîª
        function initializeGardenBackground() {
            const gardens = document.querySelectorAll('.garden-background');
            gardens.forEach(garden => {
                createVines(garden);
                createFlowers(garden);
                createButterflies(garden);
            });
        }

        function createVines(garden) {
            const numVines = 8;
            for (let i = 0; i < numVines; i++) {
                const vine = document.createElement('div');
                vine.className = 'vine';
                vine.style.left = `${Math.random() * 100}%`;
                vine.style.setProperty('--vine-height', `${150 + Math.random() * 200}px`);
                vine.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
                vine.style.animationDelay = `${i * 0.5}s`;
                garden.appendChild(vine);
            }
        }

        function createFlowers(garden) {
            const numFlowers = 12;
            const flowerTypes = ['red', 'pink', 'yellow', 'white'];
            const flowerEmojis = ['üåπ', 'üå∏', 'üåº', 'üå∫'];
            
            for (let i = 0; i < numFlowers; i++) {
                const flower = document.createElement('div');
                const typeIndex = Math.floor(Math.random() * flowerTypes.length);
                flower.className = `garden-flower ${flowerTypes[typeIndex]}`;
                flower.textContent = flowerEmojis[typeIndex];
                flower.style.left = `${Math.random() * 90 + 5}%`;
                flower.style.top = `${Math.random() * 90 + 5}%`;
                flower.style.animationDelay = `${i * 0.3}s`;
                garden.appendChild(flower);
            }
        }

        function createButterflies(garden) {
            const numButterflies = 5;
            for (let i = 0; i < numButterflies; i++) {
                const butterfly = document.createElement('div');
                butterfly.className = 'butterfly';
                butterfly.textContent = 'ü¶ã';
                butterfly.style.setProperty('--hue', `${Math.random() * 360}deg`);
                butterfly.style.animationDelay = `${i * 2}s`;
                garden.appendChild(butterfly);
            }
        }

        // Ê∑ªÂä†ÊµÅÂä®Ê†ëÂè∂ËÉåÊôØÂàùÂßãÂåñ
        function initializeFloatingLeaves() {
            const container = document.getElementById('floatingLeaves');
            const numLeaves = 20;
            
            for (let i = 0; i < numLeaves; i++) {
                const leaf = document.createElement('div');
                leaf.className = 'floating-leaf';
                
                // ÈöèÊú∫Ëµ∑Âßã‰ΩçÁΩÆÂíåÂª∂Ëøü
                leaf.style.left = `${Math.random() * 100}%`;
                leaf.style.top = `${Math.random() * 100}%`;
                leaf.style.animationDelay = `${Math.random() * 15}s`;
                
                // ÈöèÊú∫Â§ßÂ∞èÂíåÊóãËΩ¨
                const scale = 0.5 + Math.random() * 1;
                const rotation = Math.random() * 360;
                leaf.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
                
                container.appendChild(leaf);
            }
        }

        // Ê∑ªÂä†Âä®ÊÄÅÂ∞èÁå´Ë°å‰∏∫
        function createActivePet() {
            console.log('ÂàõÂª∫Âä®ÊÄÅÂ∞èÁå´');
            // Â¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®Â∞èÁå´ÔºåÂÖàÁßªÈô§
            const existingPets = document.querySelectorAll('#activePet');
            existingPets.forEach(pet => pet.remove());

            const activePet = document.createElement('div');
            activePet.id = 'activePet';
            activePet.className = 'active-pet';
            
            // Ê†πÊçÆÈ¢ÜÂÖªÁöÑÂ∞èÁå´ËÆæÁΩÆÂØπÂ∫îÁöÑÂõæÁâá
            if (adoptedPet) {
                switch(adoptedPet.name) {
                    case 'ÁÅ∞ÁÅ∞':
                        activePet.style.backgroundImage = "url('public/Â∞èÁÅ∞.png')";
                        break;
                    case 'Èõ™ÁêÉ':
                        activePet.style.backgroundImage = "url('public/Èõ™ÁêÉ.png')";
                        break;
                    case 'Â§ßÊ©ò':
                        activePet.style.backgroundImage = "url('public/Â§ßËèä.png')";
                        break;
                }
            }
            
            // ËÆæÁΩÆÂàùÂßã‰ΩçÁΩÆ
            const maxX = window.innerWidth - 100;
            const maxY = window.innerHeight - 100;
            activePet.style.left = (Math.random() * maxX) + 'px';
            activePet.style.top = (Math.random() * maxY) + 'px';
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            activePet.addEventListener('click', function() {
                // ÊòæÁ§∫‰∫íÂä®ÈÄâÈ°π
                showPetInteractionOptions();
            });
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(activePet);
            
            // ÂºÄÂßãÈöèÊú∫ÁßªÂä®
            startPetMovement(activePet);
        }

        // Êõ¥Êñ∞Ê†∑Âºè
        const style = document.createElement('style');
        style.textContent = `
            .active-pet {
                position: absolute;
                width: 100px;
                height: 100px;
            background-size: contain;
            background-repeat: no-repeat;
                background-position: center;
            cursor: pointer;
                transition: all 0.5s ease;
            z-index: 1000;
            }
            
            .active-pet:hover {
                transform: scale(1.1);
            }
        `;
        document.head.appendChild(style);

        function startPetMovement(pet) {
            let currentBehavior = '';
            let currentX = parseFloat(pet.style.left);
            let currentY = parseFloat(pet.style.top);
            
            setInterval(() => {
                const container = document.querySelector('.container');
                const maxX = container.offsetWidth - 100;
                const maxY = container.offsetHeight - 100;
                
                // ÈöèÊú∫Ë°å‰∏∫
                const behavior = Math.random();
                const newBehavior = behavior < 0.3 ? 'sleeping' : behavior < 0.6 ? 'playing' : 'moving';
                
                if (currentBehavior !== newBehavior) {
                    currentBehavior = newBehavior;
                    
                    switch(newBehavior) {
                        case 'sleeping':
                            pet.className = `active-pet ${getPetClass(adoptedPet.name)} sleeping`;
                            break;
                            
                        case 'playing':
                            pet.className = `active-pet ${getPetClass(adoptedPet.name)} playing`;
                            break;
                            
                        case 'moving':
                            pet.className = `active-pet ${getPetClass(adoptedPet.name)}`;
                            const newX = Math.random() * maxX;
                            const newY = Math.random() * maxY;
                            
                            // Ê†πÊçÆÁßªÂä®ÊñπÂêëÁøªËΩ¨Â∞èÁå´
                            if (newX < currentX) {
                                pet.style.transform = 'scaleX(-1)';
                            } else {
                                pet.style.transform = 'scaleX(1)';
                            }
                            
                            pet.style.left = newX + 'px';
                            pet.style.top = newY + 'px';
                            
                            currentX = newX;
                            currentY = newY;
                            break;
                    }
                }
            }, 3000);
        }

        function getPetClass(petName) {
            switch(petName) {
                case 'ÁÅ∞ÁÅ∞': return 'gray';
                case 'Ê©òÂ≠ê': return 'orange';
                case 'Èõ™ÁêÉ': return 'white';
                default: return 'gray';
            }
        }

        // ÂõæÁâáÂ±ïÁ§∫Áõ∏ÂÖ≥ÂèòÈáèÂíåÂáΩÊï∞
        let currentImageIndex = 0;
        let images = [];
        let imageLikes = JSON.parse(localStorage.getItem('imageLikes') || '{}');

        // ÂàùÂßãÂåñÂõæÁâáÂ±ïÁ§∫ÂäüËÉΩ
        document.addEventListener('DOMContentLoaded', () => {
            // Ëé∑ÂèñÊó•Â∏∏ÁîüÊ¥ªÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const dailyLifeImage = document.querySelector('.gallery-item img[alt="Êó•Â∏∏ÁîüÊ¥ª"]');
            if (dailyLifeImage) {
                dailyLifeImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150341.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150353.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150359.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150405.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150411.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150417.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150427.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150509.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150514.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150519.jpg',
                        'public/day/ÂæÆ‰ø°ÂõæÁâá_20250402150823.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑Âèñ‰∏™‰∫∫ÂÜôÁúüÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const portraitImage = document.querySelector('.gallery-item img[alt="‰∏™‰∫∫ÂÜôÁúü"]');
            if (portraitImage) {
                portraitImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152038.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152033.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152029.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152025.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152021.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152018.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152014.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402152009.jpg',
                        'public/xiezhen/ÂæÆ‰ø°ÂõæÁâá_20250402151957.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑ÂèñÊóÖË°åÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const travelImage = document.querySelector('.gallery-item img[alt="ÊóÖË°å"]');
            if (travelImage) {
                travelImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153351.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153347.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153344.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153340.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153336.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153332.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153327.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153324.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153320.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153316.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153312.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153308.jpg',
                        'public/travel/ÂæÆ‰ø°ÂõæÁâá_20250402153257.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑ÂèñÂÖ¥Ë∂£Áà±Â•ΩÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const hobbyImage = document.querySelector('.gallery-item img[alt="ÂÖ¥Ë∂£Áà±Â•Ω"]');
            if (hobbyImage) {
                hobbyImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154457.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154452.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154447.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154441.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154437.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154426.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154420.jpg',
                        'public/like/ÂæÆ‰ø°ÂõæÁâá_20250402154409.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑ÂèñÈ£éÊôØÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const sceneryImage = document.querySelector('.gallery-item img[alt="È£éÊôØ"]');
            if (sceneryImage) {
                sceneryImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154950.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154946.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154942.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154939.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154935.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154931.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154928.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154924.jpg',
                        'public/fengjing/ÂæÆ‰ø°ÂõæÁâá_20250402154915.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑ÂèñÁæéÈ£üÂõæÁâáÁöÑÁÇπÂáª‰∫ã‰ª∂
            const foodImage = document.querySelector('.gallery-item img[alt="ÁæéÈ£ü"]');
            if (foodImage) {
                foodImage.parentElement.addEventListener('click', () => {
                    images = [
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155627.jpg',
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155623.jpg',
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155619.jpg',
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155615.jpg',
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155604.jpg',
                        'public/food/ÂæÆ‰ø°ÂõæÁâá_20250402155553.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑Âèñ‰ΩúÂìÅ‰∏ÄÁöÑÁÇπÂáª‰∫ã‰ª∂
            const work1Image = document.querySelector('.image-container[data-work="1"]');
            if (work1Image) {
                work1Image.addEventListener('click', () => {
                    images = [
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161644.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161640.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161635.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161631.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161627.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161624.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161620.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161616.jpg',
                        'public/zuopin1/ÂæÆ‰ø°ÂõæÁâá_20250402161602.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑Âèñ‰ΩúÂìÅ‰∫åÁöÑÁÇπÂáª‰∫ã‰ª∂
            const work2Image = document.querySelector('.image-container[data-work="2"]');
            if (work2Image) {
                work2Image.addEventListener('click', () => {
                    images = [
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161340.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161107.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161016.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161012.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161008.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161004.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402161000.jpg',
                        'public/zuopin2/ÂæÆ‰ø°ÂõæÁâá_20250402160948.jpg'
                    ];
                    showImageModal(0);
                });
            }

            // Ëé∑Âèñ‰ΩúÂìÅ‰∏âÁöÑÁÇπÂáª‰∫ã‰ª∂
            const work3Image = document.querySelector('.image-container[data-work="3"]');
            if (work3Image) {
                work3Image.addEventListener('click', () => {
                    images = [
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160800.jpg',
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160629.jpg',
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160624.jpg',
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160619.jpg',
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160613.jpg',
                        'public/zuopin3/ÂæÆ‰ø°ÂõæÁâá_20250402160600.jpg'
                    ];
                    showImageModal(0);
                });
            }
        });

        function showImageModal(index) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const likeButton = document.querySelector('.like-button');
            const likeCount = document.querySelector('.like-count');
            
            if (images.length === 0) {
                alert('Ê≤°ÊúâÊâæÂà∞ÂõæÁâá');
                return;
            }
            
            currentImageIndex = index;
            modalImage.src = images[currentImageIndex];
            
            // Êõ¥Êñ∞ÁÇπËµûÁä∂ÊÄÅ
            const currentImage = images[currentImageIndex];
            const likes = imageLikes[currentImage] || 0;
            likeCount.textContent = likes;
            likeButton.classList.toggle('liked', likes > 0);
            
            modal.style.display = 'block';
            modal.classList.add('show');

            // Ê∑ªÂä†Ë£ÖÈ•∞Ëä±ÊúµÂíåËù¥Ëù∂
            createModalDecorations(modal);
            
            // ÂàõÂª∫ÂºπÂπïÂÆπÂô®
            const danmakuContainer = document.createElement('div');
            danmakuContainer.className = 'danmaku-container';
            modal.querySelector('.image-container').appendChild(danmakuContainer);
            
            // ÂàõÂª∫ÂºπÂπïËæìÂÖ•Ê°Ü
            const danmakuInputContainer = document.createElement('div');
            danmakuInputContainer.className = 'danmaku-input-container';
            danmakuInputContainer.innerHTML = `
                <input type="text" class="danmaku-input" placeholder="ÂèëÈÄÅÂºπÂπï...">
                <button class="danmaku-send">ÂèëÈÄÅ</button>
            `;
            modal.appendChild(danmakuInputContainer);
            
            // Ê∑ªÂä†ÂºπÂπïÂèëÈÄÅ‰∫ã‰ª∂
            const sendButton = danmakuInputContainer.querySelector('.danmaku-send');
            const input = danmakuInputContainer.querySelector('.danmaku-input');
            
            sendButton.addEventListener('click', () => sendDanmaku(input, danmakuContainer));
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendDanmaku(input, danmakuContainer);
                }
            });
        }

        function createModalDecorations(modal) {
            // ÂàõÂª∫Ëä±Êúµ
            for (let i = 0; i < 5; i++) {
                const flower = document.createElement('div');
                flower.className = 'modal-flower';
                flower.textContent = 'üå∏';
                flower.style.left = `${Math.random() * 100}%`;
                flower.style.top = `${Math.random() * 100}%`;
                flower.style.animationDelay = `${Math.random() * 2}s`;
                modal.appendChild(flower);
            }
            
            // ÂàõÂª∫Ëù¥Ëù∂
            for (let i = 0; i < 3; i++) {
                const butterfly = document.createElement('div');
                butterfly.className = 'modal-butterfly';
                butterfly.textContent = 'ü¶ã';
                butterfly.style.left = `${Math.random() * 100}%`;
                butterfly.style.top = `${Math.random() * 100}%`;
                butterfly.style.animationDelay = `${Math.random() * 2}s`;
                modal.appendChild(butterfly);
            }
        }

        function sendDanmaku(input, container) {
            const text = input.value.trim();
            if (!text) return;
            
            
            const danmaku = document.createElement('div');
            danmaku.className = 'danmaku';
            danmaku.textContent = text;
            
            // ÈöèÊú∫ÂûÇÁõ¥‰ΩçÁΩÆ
            const top = Math.random() * 80 + 10;
            danmaku.style.top = `${top}%`;
            
            container.appendChild(danmaku);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§ÂºπÂπï
            danmaku.addEventListener('animationend', () => {
                danmaku.remove();
            });
            
            input.value = '';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            
            // ÁßªÈô§ÊâÄÊúâË£ÖÈ•∞ÂÖÉÁ¥†
            modal.querySelectorAll('.modal-flower, .modal-butterfly, .danmaku-container, .danmaku-input-container').forEach(el => el.remove());
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function prevImage() {
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            document.getElementById('modalImage').src = images[currentImageIndex];
        }

        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            document.getElementById('modalImage').src = images[currentImageIndex];
        }

        // Ê∑ªÂä†ÈîÆÁõòÊéßÂà∂
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    prevImage();
                } else if (e.key === 'ArrowRight') {
                    nextImage();
                } else if (e.key === 'Escape') {
                    closeImageModal();
                }
            }
        });

        function handleLike() {
            const likeButton = document.querySelector('.like-button');
            const likeCount = document.querySelector('.like-count');
            const currentImage = images[currentImageIndex];
            
            // Êí≠ÊîæÁÇπËµûÈü≥Êïà
            const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU' + 
                '...'); // ËøôÈáåÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™ÁÆÄÁü≠ÁöÑÂºÄÂøÉÈü≥ÊïàÁöÑ base64 ÁºñÁ†Å
            
            // Êõ¥Êñ∞ÁÇπËµûÁä∂ÊÄÅ
            if (imageLikes[currentImage]) {
                imageLikes[currentImage]--;
                likeButton.classList.remove('liked');
            } else {
                imageLikes[currentImage] = 1;
                likeButton.classList.add('liked');
                audio.play().catch(() => {}); // Êí≠ÊîæÈü≥Êïà
                createLikeParticles(); // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
            }
            
            likeCount.textContent = imageLikes[currentImage];
            localStorage.setItem('imageLikes', JSON.stringify(imageLikes));
        }

        function createLikeParticles() {
            const modal = document.querySelector('.image-modal');
            const colors = ['#FF69B4', '#FFB6C1', '#FFC0CB', '#DB7093'];
            
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'like-particle';
                particle.innerHTML = '‚ù§Ô∏è';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.bottom = '20%';
                particle.style.fontSize = `${Math.random() * 20 + 10}px`;
                particle.style.color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.animationDelay = `${Math.random() * 0.5}s`;
                
                modal.appendChild(particle);
                
                // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§Á≤íÂ≠ê
                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Âà†Èô§ËØ≠Èü≥ËØÜÂà´Áõ∏ÂÖ≥‰ª£Á†Å
        let recognition = null;
        let isVoiceInputActive = false;

        // DeepSeek APIÈÖçÁΩÆ
        const DEEPSEEK_API_KEY = 'sk-638ddd655d77443495447295497cb5df';
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';
        
        // AIÂØπËØùÊ†èÁõ∏ÂÖ≥ÂáΩÊï∞
        function toggleAIChatBar() {
            const chatBar = document.querySelector('.ai-chat-bar');
            chatBar.classList.toggle('minimized');
        }
        
        function handleAIKeyPress(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }
        
        function addAIMessage(text, isUser) {
            const messagesContainer = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${isUser ? 'user-message' : ''}`;
            
            messageDiv.innerHTML = `
                <div class="ai-avatar ${isUser ? 'user-avatar' : ''}">${isUser ? '‰Ω†' : 'ÊùéËØóÊ∑º'}</div>
                <div class="ai-text ${isUser ? 'user-text' : ''}">${text}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('aiMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="ai-avatar">ÊùéËØóÊ∑º</div>
                <div class="ai-text">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        async function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (message) {
                // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
                addAIMessage(message, true);
                input.value = '';
                
                // ÊòæÁ§∫Ê≠£Âú®ËæìÂÖ•Áä∂ÊÄÅ
                showTypingIndicator();
                
                try {
                    // Ë∞ÉÁî®DeepSeek APIËé∑ÂèñÂõûÂ§ç
                    const response = await fetch(DEEPSEEK_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: "deepseek-chat",
                            messages: [
                                {
                                    role: "system",
                                    content: "‰Ω†Áé∞Âú®ÊòØÊùéËØóÊ∑ºÔºå‰∏Ä‰∏™Ê∏©ÊüîÂèØÁà±ÁöÑÂ•≥Â≠©„ÄÇ‰Ω†Ë¶ÅË°®Áé∞Âá∫‰ª•‰∏ãÁâπÁÇπÔºö1. ËØ¥ËØùÊ∏©ÊüîÁªÜËÖªÔºåÂ∏¶Êúâ‰∏Ä‰∫õÂèØÁà±ÁöÑËØ≠Ê∞îËØçÔºõ2. ÊÄßÊ†ºÂºÄÊúóÊ¥ªÊ≥ºÔºå‰ΩÜÊúâÊó∂‰πü‰ºöÂÆ≥ÁæûÔºõ3. Áî®ËØçÁÆÄÂçïËá™ÁÑ∂ÔºåÂÅ∂Â∞î‰ºö‰ΩøÁî®‰∏Ä‰∫õÂèØÁà±ÁöÑË°®ÊÉÖÁ¨¶Âè∑Ôºõ4. ÂØπ‰∫∫ÊúâÁ§ºË≤åÔºå‰ºöÂÖ≥ÂøÉÂØπÊñπÔºõ5. ÂõûÁ≠îË¶ÅÁÆÄÁü≠ÊúâË∂£Ôºå‰∏çË¶ÅÂ§™Èïø„ÄÇËØ∑Áî®ËøôÁßçÈ£éÊ†ºÊù•ÂõûÁ≠îÁî®Êà∑ÁöÑÈóÆÈ¢ò„ÄÇ"
                                },
                                {
                                    role: "user",
                                    content: message
                                }
                            ],
                            temperature: 0.7,
                            max_tokens: 500
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('APIËØ∑Ê±ÇÂ§±Ë¥•');
                    }
                    
                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;
                    
                    // ÁßªÈô§ËæìÂÖ•Áä∂ÊÄÅÊòæÁ§∫
                    removeTypingIndicator();
                    
                    // ÊòæÁ§∫AIÂõûÂ§ç
                    addAIMessage(aiResponse, false);
                } catch (error) {
                    console.error('APIË∞ÉÁî®ÈîôËØØ:', error);
                    
                    // ÁßªÈô§ËæìÂÖ•Áä∂ÊÄÅÊòæÁ§∫
                    removeTypingIndicator();
                    
                    // ÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
                    addAIMessage('Êä±Ê≠âÔºåÊàëÁé∞Âú®ÊúâÁÇπÁ¥ØÔºåÁ®çÂêéÂÜçÂíå‰Ω†ËÅäÂ§©Âêß~', false);
                }
            }
        }
        
        // Á°Æ‰øùDOMÂä†ËΩΩÂÆåÊàêÂêéÂÜçÊâßË°å
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
        });

        // Ê∑ªÂä†Ê∂àÊÅØÁöÑÂáΩÊï∞
        function addMessage(content) {
            if (!content.trim()) return; // Â¶ÇÊûúÊ∂àÊÅØ‰∏∫Á©∫Ôºå‰∏çÊ∑ªÂä†
            
            const newMessage = {
                content: content,
                time: new Date().toLocaleString()
            };
            mailboxMessages.push(newMessage);
            localStorage.setItem('mailboxMessages', JSON.stringify(mailboxMessages));
            displayMessages();
            updateMailboxCount();
        }

        // ÂàáÊç¢Ê∂àÊÅØÊòæÁ§∫
        function toggleMessages() {
            const modal = document.getElementById('messages-modal');
            if (modal.style.display === 'none' || !modal.style.display) {
                displayMessages();
                modal.style.display = 'block';
            } else {
                modal.style.display = 'none';
            }
        }

        // Êõ¥Êñ∞ÈÇÆÁÆ±Êï∞Â≠ó
        function updateMailboxCount() {
            const countElement = document.querySelector('.mailbox-count');
            if (countElement) {
                countElement.textContent = mailboxMessages.length;
            }
        }

        // ÂàùÂßãÂåñÊó∂Êõ¥Êñ∞ÈÇÆÁÆ±Êï∞Â≠ó
        document.addEventListener('DOMContentLoaded', () => {
            updateMailboxCount();
        });

        // Ê∑ªÂä†ÊëÑÂÉèÂ§¥Áõ∏ÂÖ≥ÂèòÈáè
        let video = null;
        let stream = null;
        let canvas = null;
        let ctx = null;
        let isGestureControlActive = false;
        let gestureDetectionInterval = null;

        // ÂàùÂßãÂåñÊëÑÂÉèÂ§¥
        async function initCamera() {
            try {
                console.log('Ê≠£Âú®ÂàùÂßãÂåñÊëÑÂÉèÂ§¥...');
                
                // ÂàõÂª∫ËßÜÈ¢ëÂÖÉÁ¥†
                if (!video) {
                    video = document.createElement('video');
                    video.id = 'cameraFeed';
                    video.style.position = 'fixed';
                    video.style.bottom = '20px';
                    video.style.right = '20px';
                    video.style.width = '200px';
                    video.style.height = '150px';
                    video.style.transform = 'scaleX(-1)'; // ÈïúÂÉèÊòæÁ§∫
                    video.style.display = 'none';
                    video.style.zIndex = '1000';
                    video.style.border = '2px solid var(--dark-green)';
                    video.style.borderRadius = '10px';
                    document.body.appendChild(video);
                    console.log('ËßÜÈ¢ëÂÖÉÁ¥†Â∑≤ÂàõÂª∫');
                }

                // ÂàõÂª∫canvasÁî®‰∫éÂàÜÊûêËßÜÈ¢ëÂ∏ß
                if (!canvas) {
                    canvas = document.createElement('canvas');
                    canvas.width = 200;
                    canvas.height = 150;
                    ctx = canvas.getContext('2d');
                    console.log('CanvasÂ∑≤ÂàõÂª∫');
                }

                // Ëé∑ÂèñÊëÑÂÉèÂ§¥ÊùÉÈôêÂπ∂ÂºÄÂßãËßÜÈ¢ëÊµÅ
                console.log('Ê≠£Âú®ËØ∑Ê±ÇÊëÑÂÉèÂ§¥ÊùÉÈôê...');
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 200, 
                        height: 150,
                        facingMode: 'user' // ÊåáÂÆö‰ΩøÁî®ÂâçÁΩÆÊëÑÂÉèÂ§¥
                    } 
                });
                console.log('ÊëÑÂÉèÂ§¥ÊùÉÈôêÂ∑≤Ëé∑Âèñ');
                
                if (video.srcObject !== stream) {
                    video.srcObject = stream;
                }
                
                // Á≠âÂæÖËßÜÈ¢ëÂºÄÂßãÊí≠Êîæ
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play().then(() => {
                            console.log('ËßÜÈ¢ëÂºÄÂßãÊí≠Êîæ');
                            resolve();
                        }).catch(error => {
                            console.error('ËßÜÈ¢ëÊí≠ÊîæÂ§±Ë¥•:', error);
                        });
                    };
                });

                // ÊòæÁ§∫ËßÜÈ¢ëÂÖÉÁ¥†
                video.style.display = 'block';
                console.log('ÊëÑÂÉèÂ§¥Â∑≤ÂêØÂä®');

                // ÂºÄÂßãÊâãÂäøÊ£ÄÊµã
                startGestureDetection();
            } catch (error) {
                console.error('ÊëÑÂÉèÂ§¥ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                alert('Êó†Ê≥ïËÆøÈóÆÊëÑÂÉèÂ§¥ÔºåËØ∑Á°Æ‰øùÂ∑≤Êéà‰∫àÊëÑÂÉèÂ§¥ÊùÉÈôê„ÄÇ');
                isGestureControlActive = false;
                const gestureButton = document.getElementById('gestureControl');
                if (gestureButton) {
                    gestureButton.textContent = 'ÂºÄÂßãÊâãÂäøÊéßÂà∂';
                    gestureButton.classList.remove('active');
                }
            }
        }

        // ÂÅúÊ≠¢ÊëÑÂÉèÂ§¥
        function stopCamera() {
            console.log('Ê≠£Âú®ÂÅúÊ≠¢ÊëÑÂÉèÂ§¥...');
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            if (video) {
                video.style.display = 'none';
                video.srcObject = null;
            }
            if (gestureDetectionInterval) {
                clearInterval(gestureDetectionInterval);
                gestureDetectionInterval = null;
            }
            isGestureControlActive = false;
            console.log('ÊëÑÂÉèÂ§¥Â∑≤ÂÅúÊ≠¢');
        }

        // ÂàáÊç¢ÊâãÂäøÊéßÂà∂
        function toggleGestureControl() {
            console.log('ÂàáÊç¢ÊâãÂäøÊéßÂà∂Áä∂ÊÄÅ:', !isGestureControlActive);
            const gestureButton = document.getElementById('gestureControl');
            if (!isGestureControlActive) {
                isGestureControlActive = true;
                gestureButton.textContent = 'ÂÅúÊ≠¢ÊâãÂäøÊéßÂà∂';
                gestureButton.classList.add('active');
                initCamera();
                document.getElementById('mazeInfo').textContent = 'Â∞ÜÊâãÊîæÂú®ÊëÑÂÉèÂ§¥ÁîªÈù¢‰∏≠ÂøÉÔºåÁÑ∂ÂêéÂêëÊÉ≥Ë¶ÅÁßªÂä®ÁöÑÊñπÂêëÁßªÂä®';
            } else {
                isGestureControlActive = false;
                gestureButton.textContent = 'ÂºÄÂßãÊâãÂäøÊéßÂà∂';
                gestureButton.classList.remove('active');
                stopCamera();
                document.getElementById('mazeInfo').textContent = '‰ΩøÁî®ÊñπÂêëÈîÆÊàñÊâãÂäøÊéßÂà∂Â∞èÁå´ÁßªÂä®ÔºÅ';
            }
        }

        // Ê∑ªÂä†ÊâãÂäøÊéßÂà∂ÊåâÈíÆ
        function addGestureControlButton() {
            console.log('Ê≠£Âú®Ê∑ªÂä†ÊâãÂäøÊéßÂà∂ÊåâÈíÆ...');
            const controlsDiv = document.querySelector('.maze-controls');
            if (controlsDiv) {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÊâãÂäøÊéßÂà∂ÊåâÈíÆ
                if (!document.getElementById('gestureControl')) {
                    const gestureButton = document.createElement('button');
                    gestureButton.id = 'gestureControl';
                    gestureButton.textContent = 'ÂºÄÂßãÊâãÂäøÊéßÂà∂';
                    gestureButton.onclick = toggleGestureControl;
                    gestureButton.style.marginLeft = '10px';
                    gestureButton.style.padding = '8px 16px';
                    gestureButton.style.backgroundColor = 'var(--light-green)';
                    gestureButton.style.color = 'var(--dark-green)';
                    gestureButton.style.border = 'none';
                    gestureButton.style.borderRadius = '20px';
                    gestureButton.style.cursor = 'pointer';
                    gestureButton.style.transition = 'all 0.3s ease';
                    controlsDiv.appendChild(gestureButton);
                    console.log('ÊâãÂäøÊéßÂà∂ÊåâÈíÆÂ∑≤Ê∑ªÂä†');
                }
            } else {
                console.error('Êú™ÊâæÂà∞Ëø∑ÂÆ´ÊéßÂà∂Âå∫Âüü');
            }
        }

        // Âú®È°µÈù¢Âä†ËΩΩÊó∂Ê∑ªÂä†ÊâãÂäøÊéßÂà∂ÊåâÈíÆ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂàùÂßãÂåñÊâãÂäøÊéßÂà∂...');
            addGestureControlButton();
        });

        // ÂºÄÂßãÊâãÂäøÊ£ÄÊµã
        function startGestureDetection() {
            if (gestureDetectionInterval) {
                clearInterval(gestureDetectionInterval);
            }

            gestureDetectionInterval = setInterval(() => {
                if (!ctx || !video || !isGestureControlActive) return;

                // Â∞ÜËßÜÈ¢ëÂ∏ßÁªòÂà∂Âà∞canvas
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Ê£ÄÊµãÊâãÊåá‰ΩçÁΩÆ
                const fingerSize = 30;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Ê£ÄÊµã‰∏≠ÂøÉÂå∫Âüü
                const centerData = ctx.getImageData(centerX - fingerSize/2, centerY - fingerSize/2, fingerSize, fingerSize);
                let centerBrightness = 0;
                for (let i = 0; i < centerData.data.length; i += 4) {
                    centerBrightness += (centerData.data[i] + centerData.data[i + 1] + centerData.data[i + 2]) / 3;
                }
                centerBrightness /= (centerData.data.length / 4);

                // Â¶ÇÊûúÊ£ÄÊµãÂà∞ÊâãÊåá
                if (centerBrightness > 50) {
                    // Ê£ÄÊµãÊâãÊåáÁßªÂä®ÊñπÂêë
                    const directions = {
                        up: { x: centerX, y: centerY - fingerSize },
                        down: { x: centerX, y: centerY + fingerSize },
                        left: { x: centerX - fingerSize, y: centerY },
                        right: { x: centerX + fingerSize, y: centerY }
                    };

                    let maxDiff = 0;
                    let detectedDirection = null;

                    // Ê£ÄÊü•Âõõ‰∏™ÊñπÂêëÁöÑ‰∫ÆÂ∫¶Â∑ÆÂºÇ
                    for (const [direction, pos] of Object.entries(directions)) {
                        const data = ctx.getImageData(pos.x - fingerSize/2, pos.y - fingerSize/2, fingerSize, fingerSize);
                        let brightness = 0;
                        for (let i = 0; i < data.data.length; i += 4) {
                            brightness += (data.data[i] + data.data[i + 1] + data.data[i + 2]) / 3;
                        }
                        brightness /= (data.data.length / 4);

                        const diff = Math.abs(brightness - centerBrightness);
                        if (diff > maxDiff && brightness > 50) {
                            maxDiff = diff;
                            detectedDirection = direction;
                        }
                    }

                    // Â¶ÇÊûúÊ£ÄÊµãÂà∞ÊñπÂêëÔºåÁßªÂä®Â∞èÁå´
                    if (detectedDirection) {
                        moveCat(detectedDirection);
                        console.log('Ê£ÄÊµãÂà∞ÊñπÂêë:', detectedDirection, '‰∫ÆÂ∫¶Â∑ÆÂºÇ:', maxDiff);
                    }
                }
            }, 50); // Êõ¥Âø´ÁöÑÊ£ÄÊµãÈ¢ëÁéá
        }

        function handleAdoptionClick() {
            console.log('ÁÇπÂáª‰∫ÜÈ¢ÜÂÖªÊåâÈíÆ');
            const overlay = document.getElementById('adoptionOverlay');
            const modal = document.getElementById('adoptionModal');
            
            if (!overlay || !modal) {
                console.error('Êâæ‰∏çÂà∞È¢ÜÂÖªÂºπÁ™óÂÖÉÁ¥†');
                return;
            }
            
            overlay.style.display = 'block';
            modal.style.display = 'block';
            
            // Ê∑ªÂä†ÊòæÁ§∫Âä®Áîª
            requestAnimationFrame(() => {
                overlay.classList.add('show');
                modal.classList.add('show');
            });
        }

        function checkWin() {
            if (playerX === exitX && playerY === exitY) {
                isGameActive = false;
                showMazeCelebration();
            }
        }

        function showMazeCelebration() {
            // ÂàõÂª∫Â∫ÜÁ•ùÂÆπÂô®
            const celebrationContainer = document.createElement('div');
            celebrationContainer.className = 'maze-celebration-container';
            document.body.appendChild(celebrationContainer);

            // Ê∑ªÂä†ËÉåÊôØÈÅÆÁΩ©
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';
            celebrationContainer.appendChild(overlay);

            // Ê∑ªÂä†ÁÉüËä±ÊïàÊûú
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createMazeFirework();
                }, i * 150);
            }

            // Ê∑ªÂä†ÂΩ©Â∏¶ÊïàÊûú
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    createMazeConfetti();
                }, i * 50);
            }

            // Ê∑ªÂä†ÊòüÊòüÊïàÊûú
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createStar();
                }, i * 200);
            }

            // Ê∑ªÂä†ÈÄöÂÖ≥ÊñáÂ≠ó
            const congratsText = document.createElement('div');
            congratsText.className = 'maze-congrats-text';
            congratsText.innerHTML = `
                <div class="maze-congrats-title">ÊÅ≠ÂñúÈÄöÂÖ≥ÔºÅüéâ</div>
                <div class="maze-congrats-subtitle">‰Ω†ÊàêÂäüËµ∞Âá∫‰∫ÜËø∑ÂÆ´ÔºÅ</div>
            `;
            celebrationContainer.appendChild(congratsText);

            // Êí≠ÊîæÂ∫ÜÁ•ùÈü≥Êïà
            const audio = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU' + 
                '...'); // ËøôÈáåÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™ÁÆÄÁü≠ÁöÑÂ∫ÜÁ•ùÈü≥ÊïàÁöÑ base64 ÁºñÁ†Å
            audio.play().catch(() => {});

            // 5ÁßíÂêéÁßªÈô§Â∫ÜÁ•ùÊïàÊûú
            setTimeout(() => {
                celebrationContainer.remove();
            }, 5000);
        }

        function createMazeFirework() {
            const firework = document.createElement('div');
            firework.className = 'maze-firework';
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            
            // ÈöèÊú∫È¢úËâ≤
            const colors = ['#FFD700', '#FF4500', '#00FF00', '#4169E1', '#FF69B4'];
            firework.style.background = `radial-gradient(circle, ${colors[Math.floor(Math.random() * colors.length)]}, transparent)`;
            
            document.body.appendChild(firework);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                firework.remove();
            }, 1500);
        }

        function createMazeConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'maze-confetti';
            
            // ÈöèÊú∫ÂΩ¢Áä∂ÂíåÁ±ªÂûã
            const types = ['circle', 'square', 'triangle', 'spiral', 'glitter', 'ribbon'];
            const type = types[Math.floor(Math.random() * types.length)];
            confetti.classList.add(type);
            
            // ÈöèÊú∫È¢úËâ≤
            const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#FFD700', '#FF69B4', '#4169E1'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.backgroundColor = color;
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 15 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            
            // ÈöèÊú∫‰ΩçÁΩÆÂíåÊóãËΩ¨
            const x = Math.random() * window.innerWidth;
            const rotation = Math.random() * 360;
            const delay = Math.random() * 2;
            
            confetti.style.left = x + 'px';
            confetti.style.transform = `rotate(${rotation}deg)`;
            confetti.style.animationDelay = `${delay}s`;
            
            document.body.appendChild(confetti);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }

        function createStar() {
            const star = document.createElement('div');
            star.className = 'maze-star';
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            
            star.style.left = x + 'px';
            star.style.top = y + 'px';
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 20 + 10;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            
            document.body.appendChild(star);
            
            // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
            setTimeout(() => {
                star.remove();
            }, 2000);
        }

        // Ê∑ªÂä†Ëø∑ÂÆ´Â∫ÜÁ•ùÂä®ÁîªÁöÑÊ†∑Âºè
        const mazeCelebrationStyles = `
            .maze-celebration-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }

            .celebration-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(5px);
            }

            .maze-congrats-text {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
                z-index: 1001;
            }

            .maze-congrats-title {
                font-size: 64px;
                font-weight: bold;
                color: #FFD700;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                margin-bottom: 20px;
                animation: bounce 1s infinite;
            }

            .maze-congrats-subtitle {
                font-size: 24px;
                color: white;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            }

            .maze-firework {
                position: fixed;
                width: 5px;
                height: 5px;
                border-radius: 50%;
                animation: mazeExplode 1.5s forwards;
            }

            .maze-confetti {
                position: fixed;
                width: 10px;
                height: 10px;
                animation: mazeFall 3s linear forwards;
            }

            .maze-confetti.circle {
                border-radius: 50%;
            }

            .maze-confetti.triangle {
                width: 0;
                height: 0;
                border-left: 5px solid transparent;
                border-right: 5px solid transparent;
                border-bottom: 10px solid currentColor;
                background: none;
            }

            .maze-star {
                position: fixed;
                background: #FFD700;
                clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
                animation: mazeTwinkle 2s infinite;
            }

            @keyframes bounce {
                0%, 100% { transform: translate(-50%, -50%) scale(1); }
                50% { transform: translate(-50%, -50%) scale(1.2); }
            }

            @keyframes mazeExplode {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(30); opacity: 0; }
            }

            @keyframes mazeFall {
                0% { transform: translateY(-100px) rotate(0deg); }
                100% { transform: translateY(100vh) rotate(360deg); }
            }

            @keyframes mazeTwinkle {
                0%, 100% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.5; transform: scale(0.8); }
            }
        `;

        // Ê∑ªÂä†Ê†∑ÂºèÂà∞È°µÈù¢
        const styleSheet = document.createElement('style');
        styleSheet.textContent = mazeCelebrationStyles;
        document.head.appendChild(styleSheet);

        // ÂàõÂª∫ÊâãÂäøÂèçÈ¶àÂÖÉÁ¥†
        const gestureFeedback = document.createElement('div');
        gestureFeedback.className = 'gesture-feedback';
        document.body.appendChild(gestureFeedback);

        function showGestureFeedback(text) {
            gestureFeedback.textContent = text;
            gestureFeedback.classList.add('show');
            setTimeout(() => {
                gestureFeedback.classList.remove('show');
            }, 2000);
        }

        // ‰øÆÊîπÊâãÂäøÂ§ÑÁêÜÂáΩÊï∞
        function handleZoomIn() {
            showGestureFeedback('ÊîæÂ§ß');
            // ÊâßË°åÊîæÂ§ßÊìç‰Ωú
        }

        function handleZoomOut() {
            showGestureFeedback('Áº©Â∞è');
            // ÊâßË°åÁº©Â∞èÊìç‰Ωú
        }

        function handleRotation(angle) {
            showGestureFeedback(angle > 0 ? 'È°∫Êó∂ÈíàÊóãËΩ¨' : 'ÈÄÜÊó∂ÈíàÊóãËΩ¨');
            // ÊâßË°åÊóãËΩ¨Êìç‰Ωú
        }

        function handlePan(touchPoints) {
            showGestureFeedback('Âπ≥Áßª');
            // ÊâßË°åÂπ≥ÁßªÊìç‰Ωú
        }

        // Ê†áÁ≠æÁÇπËµûÂäüËÉΩ
        document.addEventListener('DOMContentLoaded', function() {
            const tags = document.querySelectorAll('.tag');
            const MAX_SCALE = 2; // ÊúÄÂ§ßÊîæÂ§ßÂÄçÊï∞
            const INITIAL_SCALE = 1; // ÂàùÂßãÂ§ßÂ∞è

            tags.forEach(tag => {
                tag.addEventListener('click', function() {
                    // Ëé∑ÂèñÂΩìÂâçÂ§ßÂ∞è
                    const currentSize = parseFloat(this.style.transform) || INITIAL_SCALE;
                    let newSize;
                    
                    // Â¶ÇÊûúÂΩìÂâçÂ§ßÂ∞èÂ∑≤ÁªèËææÂà∞ÊúÄÂ§ßÔºåÂàôÈáçÁΩÆ
                    if (currentSize >= MAX_SCALE) {
                        newSize = INITIAL_SCALE;
                        // Ê∑ªÂä†ÈáçÁΩÆÂä®Áîª
                        this.style.animation = 'resetAnimation 0.5s ease';
                    } else {
                        // Âê¶ÂàôÂ¢ûÂä†Â§ßÂ∞è
                        newSize = currentSize + 0.1;
                        // Ê∑ªÂä†ÁÇπËµûÂä®Áîª
                        this.style.animation = 'likeAnimation 0.5s ease';
                    }
                    
                    // Â∫îÁî®Êñ∞ÁöÑÂèòÊç¢
                    this.style.transform = `scale(${newSize})`;
                    
                    // Âä®ÁîªÁªìÊùüÂêéÊÅ¢Â§çÊµÆÂä®Âä®Áîª
                    setTimeout(() => {
                        this.style.animation = 'floatAnimation 3s infinite ease-in-out';
                    }, 500);
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // ‰∏∫ÊØè‰∏™Ê†áÁ≠æÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', function(e) {
                    // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°
                    e.stopPropagation();
                    
                    // Ëé∑ÂèñÁÇπËµûËÆ°Êï∞ÂÖÉÁ¥†
                    const likeCount = this.querySelector('.like-count');
                    let count = parseInt(likeCount.textContent) || 0;
                    count++;
                    
                    // Êõ¥Êñ∞ÁÇπËµûÊï∞
                    likeCount.textContent = count;
                    likeCount.style.opacity = '1';
                    
                    // Ê∑ªÂä†ÂºπË∑≥Âä®Áîª
                    likeCount.style.animation = 'countBounce 0.5s ease';
                    setTimeout(() => {
                        likeCount.style.animation = '';
                    }, 500);
                    
                    // ÂàõÂª∫Áà±ÂøÉÂÖÉÁ¥†
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    
                    // ËÆæÁΩÆÁà±ÂøÉÁöÑÂàùÂßã‰ΩçÁΩÆ
                    const rect = this.getBoundingClientRect();
                    heart.style.left = `${rect.left + rect.width/2 - 12}px`;
                    heart.style.top = `${rect.top + rect.height/2 - 12}px`;
                    
                    // Ê∑ªÂä†Âà∞È°µÈù¢
                    document.body.appendChild(heart);
                    
                    // Ëß¶ÂèëÂä®Áîª
                    requestAnimationFrame(() => {
                        heart.style.animation = 'heartFloat 1s forwards';
                    });
                    
                    // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§Áà±ÂøÉ
                    setTimeout(() => {
                        heart.remove();
                    }, 1000);
                    
                    // Ê∑ªÂä†ÁÇπÂáªÁº©ÊîæÊïàÊûú
                    this.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
        });

        // Face++ APIÈÖçÁΩÆ
        const FACE_API_KEY = '27SLmG8dL7md9hGtv6Su3SiVriZYpKme';
        const FACE_API_SECRET = 'kRegMphzgXgjQQeA2-56V4pZHKv3P1o8';
        const FACE_API_URL = 'https://api-cn.faceplusplus.com/facepp/v3/detect';

        // Ë°®ÊÉÖÊò†Â∞Ñ
        const emotionToEmoji = {
            happiness: ['üòä', 'üå∏', 'üç∞', 'üéà'],
            sadness: ['üò¢', '‚òî', 'üåßÔ∏è', 'ü´Ç'],
            neutral: ['üòå', 'üçÄ', 'üåø', 'üí´'],
            surprise: ['üò≤', '‚ú®', 'üéâ', 'üéä'],
            anger: ['üò†', '‚ö°', 'üî•', 'üí¢'],
            disgust: ['üòñ', 'üå™Ô∏è', 'üçÇ', 'üí®'],
            fear: ['üò®', '‚ùÑÔ∏è', 'üåô', 'üå´Ô∏è']
        };

        async function analyzePhoto(photoDataUrl) {
            try {
                // Â∞Übase64ÂõæÁâáÊï∞ÊçÆËΩ¨Êç¢‰∏∫blob
                const response = await fetch(photoDataUrl);
                const blob = await response.blob();

                // ÂàõÂª∫FormDataÂØπË±°
                const formData = new FormData();
                formData.append('api_key', FACE_API_KEY);
                formData.append('api_secret', FACE_API_SECRET);
                formData.append('image_file', blob);
                formData.append('return_attributes', 'emotion');

                // Ë∞ÉÁî®Face++ API
                const result = await fetch(FACE_API_URL, {
                    method: 'POST',
                    body: formData
                });

                const data = await result.json();
                return data.faces?.[0]?.attributes?.emotion || null;
            } catch (error) {
                console.error('Ë°®ÊÉÖËØÜÂà´Â§±Ë¥•:', error);
                return null;
            }
        }

        function getEmotionEmojis(emotions) {
            if (!emotions) return [];
            
            // ÊâæÂá∫ÊúÄ‰∏ªË¶ÅÁöÑÊÉÖÁª™
            let maxEmotion = Object.entries(emotions).reduce((a, b) => 
                a[1] > b[1] ? a : b
            )[0].toLowerCase();
            
            return emotionToEmoji[maxEmotion] || emotionToEmoji.neutral;
        }

        function createFloatingEmojis(container, emojis) {
            emojis.forEach((emoji, index) => {
                const emojiElement = document.createElement('div');
                emojiElement.className = 'floating-emoji';
                emojiElement.textContent = emoji;
                
                // ÈöèÊú∫‰ΩçÁΩÆÂíåÂä®ÁîªÂª∂Ëøü
                const angle = (index / emojis.length) * 2 * Math.PI;
                const radius = 50;
                const left = 50 + radius * Math.cos(angle);
                const top = 50 + radius * Math.sin(angle);
                
                emojiElement.style.cssText = `
                    position: absolute;
                    left: ${left}%;
                    top: ${top}%;
                    font-size: 24px;
                    animation: floatEmoji 3s infinite ${index * 0.5}s;
                    z-index: 2;
                `;
                
                container.appendChild(emojiElement);
            });
        }

        async function savePhoto() {
            const photoPreview = document.getElementById('photoPreview');
            const photoWall = document.getElementById('photoWall');
            const savedPhotosTitle = document.getElementById('savedPhotosTitle');
            
            // ÂàÜÊûêÁÖßÁâá‰∏≠ÁöÑË°®ÊÉÖ
            const emotions = await analyzePhoto(photoPreview.src);
            const emojis = getEmotionEmojis(emotions);
            
            // ÂàõÂª∫Êñ∞ÁöÑÁÖßÁâáÂÖÉÁ¥†
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            
            // ÁîüÊàêÂîØ‰∏ÄID
            const photoId = 'photo_' + Date.now();
            photoItem.id = photoId;
            
            // Ëé∑ÂèñÂΩìÂâçÊó•ÊúüÊó∂Èó¥
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN') + ' ' + 
                         now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            
            // ËÆæÁΩÆÁÖßÁâáHTML
            photoItem.innerHTML = `
                <div class="photo-container" style="position: relative; width: 100%; height: 100%;">
                    <img src="${photoPreview.src}" alt="‰øùÂ≠òÁöÑÁÖßÁâá">
                    <button class="delete-btn" onclick="deletePhoto('${photoId}')">√ó</button>
                    <div class="photo-date">${dateStr}</div>
                </div>
            `;
            
            // Ê∑ªÂä†Ë°®ÊÉÖË£ÖÈ•∞
            const photoContainer = photoItem.querySelector('.photo-container');
            createFloatingEmojis(photoContainer, emojis);
            
            // Ê∑ªÂä†Âà∞ÁÖßÁâáÂ¢ô
            photoWall.insertBefore(photoItem, photoWall.firstChild);
            savedPhotosTitle.style.display = 'block';
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            saveToLocalStorage(photoId, {
                src: photoPreview.src,
                date: dateStr,
                emojis: emojis
            });
            
            // ÂÖ≥Èó≠Áõ∏Êú∫Âπ∂ÈáçÁΩÆÁïåÈù¢
            if (window.cameraStream) {
                window.cameraStream.getTracks().forEach(track => track.stop());
                window.cameraStream = null;
            }
            
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
            
            // ÊòæÁ§∫‰øùÂ≠òÊàêÂäüÊèêÁ§∫
            alert('ÁÖßÁâá‰øùÂ≠òÊàêÂäüÔºÅ');
        }

        // ‰øÆÊîπÂä†ËΩΩ‰øùÂ≠òÁöÑÁÖßÁâáÁöÑÂáΩÊï∞
        window.addEventListener('load', function() {
            const savedPhotos = JSON.parse(localStorage.getItem('savedPhotos') || '{}');
            const photoWall = document.getElementById('photoWall');
            const savedPhotosTitle = document.getElementById('savedPhotosTitle');
            
            if (Object.keys(savedPhotos).length > 0) {
                savedPhotosTitle.style.display = 'block';
                
                Object.entries(savedPhotos).forEach(([id, data]) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    photoItem.id = id;
                    
                    photoItem.innerHTML = `
                        <div class="photo-container" style="position: relative; width: 100%; height: 100%;">
                            <img src="${data.src}" alt="‰øùÂ≠òÁöÑÁÖßÁâá">
                            <button class="delete-btn" onclick="deletePhoto('${id}')">√ó</button>
                            <div class="photo-date">${data.date}</div>
                        </div>
                    `;
                    
                    // Â¶ÇÊûúÊúâË°®ÊÉÖÊï∞ÊçÆÔºåÊ∑ªÂä†Ë°®ÊÉÖË£ÖÈ•∞
                    if (data.emojis) {
                        const photoContainer = photoItem.querySelector('.photo-container');
                        createFloatingEmojis(photoContainer, data.emojis);
                    }
                    
                    photoWall.appendChild(photoItem);
                });
            }
        });

        // Ê∑ªÂä†Âà∞Â∑≤ÊúâÁöÑËÑöÊú¨‰∏≠
        const API_KEY = 'live_okaGEkjIEiSU3bRsxaffC7B2DgEfupahYbCrTaE0o8gKLlnYHuYnpKxise9d8s7n';
        const dogImage = document.getElementById('randomDogImage');
        const generateBtn = document.getElementById('generateDogBtn');
        const voiceControlBtn = document.getElementById('voiceControlBtn');
        const voiceStatus = document.getElementById('voiceStatus');
        const loadingSpinner = document.querySelector('.loading-spinner');

        // ÂàùÂßãÂåñËØ≠Èü≥ËØÜÂà´
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'zh-CN';

                recognition.onstart = () => {
                    voiceStatus.textContent = 'Ê≠£Âú®ËÅÜÂê¨...';
                    voiceControlBtn.style.backgroundColor = 'var(--bright-pink)';
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    voiceStatus.textContent = `ÊÇ®ËØ¥: ${transcript}`;
                    searchDogByDescription(transcript);
                };

                recognition.onerror = (event) => {
                    voiceStatus.textContent = 'ËØ≠Èü≥ËØÜÂà´Âá∫ÈîôÔºåËØ∑ÈáçËØï';
                    voiceControlBtn.style.backgroundColor = 'var(--dark-green)';
                };

                recognition.onend = () => {
                    voiceControlBtn.style.backgroundColor = 'var(--dark-green)';
                };
            } else {
                voiceStatus.textContent = 'ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´';
            }
        }

        // Ê†πÊçÆÊèèËø∞ÊêúÁ¥¢Â∞èÁãó
        async function searchDogByDescription(description) {
            try {
                const response = await fetch('https://api.thedogapi.com/v1/breeds/search?q=' + encodeURIComponent(description), {
                    headers: {
                        'x-api-key': API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error('ÊêúÁ¥¢Â§±Ë¥•');
                }
                
                const breeds = await response.json();
                if (breeds.length > 0) {
                    // Â¶ÇÊûúÊâæÂà∞ÂåπÈÖçÁöÑÂìÅÁßçÔºåËé∑ÂèñËØ•ÂìÅÁßçÁöÑÂõæÁâá
                    const breedId = breeds[0].id;
                    const imageResponse = await fetch(`https://api.thedogapi.com/v1/images/search?breed_id=${breedId}`, {
                        headers: {
                            'x-api-key': API_KEY
                        }
                    });
                    
                    if (!imageResponse.ok) {
                        throw new Error('Ëé∑ÂèñÂõæÁâáÂ§±Ë¥•');
                    }
                    
                    const imageData = await imageResponse.json();
                    if (imageData.length > 0) {
                        dogImage.src = imageData[0].url;
                        dogImage.style.display = 'block';
                        return breeds[0].name;
                    }
                }
                
                // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂìÅÁßçÊàñÂõæÁâáÔºåËé∑ÂèñÈöèÊú∫ÂõæÁâá
                await fetchRandomDog();
                return '';
            } catch (error) {
                console.error('Error fetching dog image:', error);
                // Â¶ÇÊûúÊêúÁ¥¢Â§±Ë¥•ÔºåËé∑ÂèñÈöèÊú∫ÂõæÁâá
                await fetchRandomDog();
                return '';
            }
        }

        async function fetchRandomDog() {
            try {
                loadingSpinner.style.display = 'block';
                dogImage.style.display = 'none';
                
                const response = await fetch('https://api.thedogapi.com/v1/images/search', {
                    headers: {
                        'x-api-key': API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Ëé∑ÂèñÂõæÁâáÂ§±Ë¥•');
                }
                
                const data = await response.json();
                dogImage.src = data[0].url;
                dogImage.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                alert('Ëé∑ÂèñÂõæÁâáÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        // ÂàùÂßãÂåñËØ≠Èü≥ËØÜÂà´
        initSpeechRecognition();

        // Ê∑ªÂä†ËØ≠Èü≥ÊéßÂà∂ÊåâÈíÆ‰∫ã‰ª∂
        voiceControlBtn.addEventListener('click', () => {
            if (recognition) {
                recognition.start();
            }
        });

        // ... existing code ...
    </script>
</body>
</html> 
